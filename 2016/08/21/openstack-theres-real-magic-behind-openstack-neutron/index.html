<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【译】 OpenStack Neutron 背后的真正魔法 | Max&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文：THERE’S REAL MAGIC BEHIND OPENSTACK NEUTRON译注：这篇博文基于 OpenStack IceHouse 版本写成。看完原文，直感到醍醐灌顶，也因此产生了翻译此文的冲动。说实话，本文的图画的很好，但有些地方逻辑却是很乱或者过于啰嗦。所以本文在必要的时候会进行一定意译，以使逻辑更为通顺。作为个人第一次科技博文翻译，定会存在各种瑕疵，敬请多多指出。 在任何博">
<meta name="keywords" content="OpenStack,翻译,Neutron,网络,OpenVSwitch">
<meta property="og:type" content="article">
<meta property="og:title" content="【译】 OpenStack Neutron 背后的真正魔法">
<meta property="og:url" content="http://xiehongfeng100.github.io/2016/08/21/openstack-theres-real-magic-behind-openstack-neutron/index.html">
<meta property="og:site_name" content="Max&#39;s Blog">
<meta property="og:description" content="原文：THERE’S REAL MAGIC BEHIND OPENSTACK NEUTRON译注：这篇博文基于 OpenStack IceHouse 版本写成。看完原文，直感到醍醐灌顶，也因此产生了翻译此文的冲动。说实话，本文的图画的很好，但有些地方逻辑却是很乱或者过于啰嗦。所以本文在必要的时候会进行一定意译，以使逻辑更为通顺。作为个人第一次科技博文翻译，定会存在各种瑕疵，敬请多多指出。 在任何博">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-1.jpg">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-2.jpg">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-3.jpg">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-4.jpg">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-5.jpg">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-6.jpg">
<meta property="og:updated_time" content="2019-05-01T06:21:57.248Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【译】 OpenStack Neutron 背后的真正魔法">
<meta name="twitter:description" content="原文：THERE’S REAL MAGIC BEHIND OPENSTACK NEUTRON译注：这篇博文基于 OpenStack IceHouse 版本写成。看完原文，直感到醍醐灌顶，也因此产生了翻译此文的冲动。说实话，本文的图画的很好，但有些地方逻辑却是很乱或者过于啰嗦。所以本文在必要的时候会进行一定意译，以使逻辑更为通顺。作为个人第一次科技博文翻译，定会存在各种瑕疵，敬请多多指出。 在任何博">
<meta name="twitter:image" content="http://xiehongfeng100.github.io/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-1.jpg">
  
    <link rel="alternative" href="/atom.xml" title="Max&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/author.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Max</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Stay hungry, stay foolish.</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/categories/架构">架构</a></li>
				        
							<li><a href="/categories/读书">读书</a></li>
				        
							<li><a href="/tags/翻译">翻译</a></li>
				        
							<li><a href="/categories/网络">网络</a></li>
				        
							<li><a href="/categories/并发">并发</a></li>
				        
							<li><a href="/categories/安全">安全</a></li>
				        
							<li><a href="/categories/运维">运维</a></li>
				        
							<li><a href="/categories/数据库">数据库</a></li>
				        
							<li><a href="/categories/云计算">云计算</a></li>
				        
							<li><a href="/categories/编程语言">编程语言</a></li>
				        
							<li><a href="/categories/操作系统">操作系统</a></li>
				        
							<li><a href="/categories/机器学习">机器学习</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/xiehongfeng100" title="github">github</a>
					        
								<a class="linkedin" target="_blank" href="http://cn.linkedin.com/in/xiehongfeng100" title="linkedin">linkedin</a>
					        
								<a class="mail" target="_blank" href="mailto:xiehongfeng100@hotmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/tmp/" style="font-size: 10px;">/tmp</a> <a href="/tags/AT-T/" style="font-size: 10px;">AT&T</a> <a href="/tags/Affin/" style="font-size: 10px;">Affin</a> <a href="/tags/Alembic/" style="font-size: 10px;">Alembic</a> <a href="/tags/B-树/" style="font-size: 10px;">B+ 树</a> <a href="/tags/BIOS/" style="font-size: 10px;">BIOS</a> <a href="/tags/C-C/" style="font-size: 16.36px;">C/C++</a> <a href="/tags/CA/" style="font-size: 10px;">CA</a> <a href="/tags/CBOW/" style="font-size: 10px;">CBOW</a> <a href="/tags/CNN/" style="font-size: 10.91px;">CNN</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/Decorator/" style="font-size: 10px;">Decorator</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Dnsmasq/" style="font-size: 10px;">Dnsmasq</a> <a href="/tags/ELF/" style="font-size: 10px;">ELF</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Elasticsearch/" style="font-size: 11.82px;">Elasticsearch</a> <a href="/tags/GCC/" style="font-size: 10px;">GCC</a> <a href="/tags/HBR/" style="font-size: 10px;">HBR</a> <a href="/tags/IO-Multiplexing/" style="font-size: 11.82px;">IO Multiplexing</a> <a href="/tags/IPTables/" style="font-size: 10px;">IPTables</a> <a href="/tags/Immunity-Debugger/" style="font-size: 10px;">Immunity Debugger</a> <a href="/tags/InnoDB/" style="font-size: 10px;">InnoDB</a> <a href="/tags/KD-Tree/" style="font-size: 10.91px;">KD-Tree</a> <a href="/tags/KNN/" style="font-size: 10px;">KNN</a> <a href="/tags/KVM/" style="font-size: 10px;">KVM</a> <a href="/tags/Kali-Linux/" style="font-size: 10px;">Kali Linux</a> <a href="/tags/Keras/" style="font-size: 10px;">Keras</a> <a href="/tags/Keystone/" style="font-size: 13.64px;">Keystone</a> <a href="/tags/Kibana/" style="font-size: 10px;">Kibana</a> <a href="/tags/Lemmatization/" style="font-size: 10px;">Lemmatization</a> <a href="/tags/Libvirt/" style="font-size: 10.91px;">Libvirt</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/LinuxBridge/" style="font-size: 11.82px;">LinuxBridge</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/Logstash/" style="font-size: 10px;">Logstash</a> <a href="/tags/MRO/" style="font-size: 10px;">MRO</a> <a href="/tags/Metasploit-Framwork/" style="font-size: 10px;">Metasploit Framwork</a> <a href="/tags/MySQL/" style="font-size: 10.91px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Namespace/" style="font-size: 10px;">Namespace</a> <a href="/tags/Neo4J/" style="font-size: 10.91px;">Neo4J</a> <a href="/tags/Neutron/" style="font-size: 13.64px;">Neutron</a> <a href="/tags/Nova/" style="font-size: 14.55px;">Nova</a> <a href="/tags/OpenStack/" style="font-size: 17.27px;">OpenStack</a> <a href="/tags/OpenVSwitch/" style="font-size: 10px;">OpenVSwitch</a> <a href="/tags/PKI/" style="font-size: 10.91px;">PKI</a> <a href="/tags/PasteDeploy/" style="font-size: 10.91px;">PasteDeploy</a> <a href="/tags/Policy/" style="font-size: 10px;">Policy</a> <a href="/tags/Python/" style="font-size: 18.18px;">Python</a> <a href="/tags/QEMU/" style="font-size: 10px;">QEMU</a> <a href="/tags/RBAC/" style="font-size: 10px;">RBAC</a> <a href="/tags/RPC/" style="font-size: 10px;">RPC</a> <a href="/tags/SQLAlchemy-Migrate/" style="font-size: 10px;">SQLAlchemy-Migrate</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/Sigmoid/" style="font-size: 10px;">Sigmoid</a> <a href="/tags/Skip-Gram/" style="font-size: 10px;">Skip-Gram</a> <a href="/tags/Socket/" style="font-size: 10px;">Socket</a> <a href="/tags/Stop-Words/" style="font-size: 10px;">Stop Words</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Tap/" style="font-size: 10.91px;">Tap</a> <a href="/tags/Token/" style="font-size: 11.82px;">Token</a> <a href="/tags/Tokenization/" style="font-size: 10px;">Tokenization</a> <a href="/tags/Trampolining/" style="font-size: 10px;">Trampolining</a> <a href="/tags/Tun/" style="font-size: 10.91px;">Tun</a> <a href="/tags/Tunnel/" style="font-size: 10px;">Tunnel</a> <a href="/tags/UUID/" style="font-size: 10px;">UUID</a> <a href="/tags/VNC/" style="font-size: 10px;">VNC</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/Veth/" style="font-size: 11.82px;">Veth</a> <a href="/tags/VirtualBox/" style="font-size: 10px;">VirtualBox</a> <a href="/tags/Vlan/" style="font-size: 10px;">Vlan</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/WSGI/" style="font-size: 13.64px;">WSGI</a> <a href="/tags/Webob/" style="font-size: 10px;">Webob</a> <a href="/tags/Word2Vec/" style="font-size: 10.91px;">Word2Vec</a> <a href="/tags/Yelper/" style="font-size: 15.45px;">Yelper</a> <a href="/tags/bootsect/" style="font-size: 10px;">bootsect</a> <a href="/tags/cookiecutter/" style="font-size: 10px;">cookiecutter</a> <a href="/tags/delete/" style="font-size: 10px;">delete</a> <a href="/tags/dnsmasq/" style="font-size: 10px;">dnsmasq</a> <a href="/tags/entry-points/" style="font-size: 10px;">entry_points</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/fork/" style="font-size: 10px;">fork</a> <a href="/tags/head/" style="font-size: 10px;">head</a> <a href="/tags/inode/" style="font-size: 10px;">inode</a> <a href="/tags/malloc/" style="font-size: 10px;">malloc</a> <a href="/tags/mona/" style="font-size: 10px;">mona</a> <a href="/tags/new/" style="font-size: 10px;">new</a> <a href="/tags/property/" style="font-size: 10px;">property</a> <a href="/tags/read/" style="font-size: 10px;">read</a> <a href="/tags/routes/" style="font-size: 10px;">routes</a> <a href="/tags/select/" style="font-size: 10px;">select</a> <a href="/tags/setup/" style="font-size: 10px;">setup</a> <a href="/tags/setuptools/" style="font-size: 10px;">setuptools</a> <a href="/tags/shell/" style="font-size: 10.91px;">shell</a> <a href="/tags/stevedore/" style="font-size: 10px;">stevedore</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/tcpdump/" style="font-size: 10px;">tcpdump</a> <a href="/tags/uWSGI/" style="font-size: 10px;">uWSGI</a> <a href="/tags/update-进程/" style="font-size: 10px;">update 进程</a> <a href="/tags/write/" style="font-size: 10px;">write</a> <a href="/tags/wsgiref/" style="font-size: 10px;">wsgiref</a> <a href="/tags/yield/" style="font-size: 14.55px;">yield</a> <a href="/tags/中断/" style="font-size: 10.91px;">中断</a> <a href="/tags/任务调度/" style="font-size: 10px;">任务调度</a> <a href="/tags/传记/" style="font-size: 10.91px;">传记</a> <a href="/tags/信号/" style="font-size: 10px;">信号</a> <a href="/tags/信号量/" style="font-size: 10px;">信号量</a> <a href="/tags/内存对齐/" style="font-size: 10px;">内存对齐</a> <a href="/tags/内存映射-I-O/" style="font-size: 10px;">内存映射 I/O</a> <a href="/tags/内存规划/" style="font-size: 10px;">内存规划</a> <a href="/tags/内核/" style="font-size: 19.09px;">内核</a> <a href="/tags/内核栈/" style="font-size: 10px;">内核栈</a> <a href="/tags/分页/" style="font-size: 10px;">分页</a> <a href="/tags/加密/" style="font-size: 10.91px;">加密</a> <a href="/tags/加载/" style="font-size: 10.91px;">加载</a> <a href="/tags/协程/" style="font-size: 13.64px;">协程</a> <a href="/tags/可执行目标文件/" style="font-size: 10.91px;">可执行目标文件</a> <a href="/tags/可重定位目标文件/" style="font-size: 10px;">可重定位目标文件</a> <a href="/tags/同步/" style="font-size: 10px;">同步</a> <a href="/tags/商业/" style="font-size: 11.82px;">商业</a> <a href="/tags/地心坐标系/" style="font-size: 10px;">地心坐标系</a> <a href="/tags/多线程/" style="font-size: 10.91px;">多线程</a> <a href="/tags/多进程/" style="font-size: 10px;">多进程</a> <a href="/tags/字符串/" style="font-size: 10px;">字符串</a> <a href="/tags/存储器/" style="font-size: 10.91px;">存储器</a> <a href="/tags/宏/" style="font-size: 10px;">宏</a> <a href="/tags/寄存器/" style="font-size: 10px;">寄存器</a> <a href="/tags/开发环境/" style="font-size: 10px;">开发环境</a> <a href="/tags/异常/" style="font-size: 10px;">异常</a> <a href="/tags/异步/" style="font-size: 10px;">异步</a> <a href="/tags/引导块/" style="font-size: 10px;">引导块</a> <a href="/tags/引导程序/" style="font-size: 12.73px;">引导程序</a> <a href="/tags/归一化/" style="font-size: 10px;">归一化</a> <a href="/tags/微处理器/" style="font-size: 13.64px;">微处理器</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a> <a href="/tags/情感分析/" style="font-size: 10px;">情感分析</a> <a href="/tags/扩容/" style="font-size: 10px;">扩容</a> <a href="/tags/指令集/" style="font-size: 10px;">指令集</a> <a href="/tags/指针/" style="font-size: 12.73px;">指针</a> <a href="/tags/数字签名/" style="font-size: 10px;">数字签名</a> <a href="/tags/数字证书/" style="font-size: 10px;">数字证书</a> <a href="/tags/整数/" style="font-size: 10px;">整数</a> <a href="/tags/文件系统/" style="font-size: 12.73px;">文件系统</a> <a href="/tags/时钟/" style="font-size: 10px;">时钟</a> <a href="/tags/时钟中断/" style="font-size: 10px;">时钟中断</a> <a href="/tags/时间衰减函数/" style="font-size: 10px;">时间衰减函数</a> <a href="/tags/权限/" style="font-size: 10px;">权限</a> <a href="/tags/架构实践/" style="font-size: 10px;">架构实践</a> <a href="/tags/标准输入/" style="font-size: 10px;">标准输入</a> <a href="/tags/标准输出/" style="font-size: 10px;">标准输出</a> <a href="/tags/标准错误输出/" style="font-size: 10px;">标准错误输出</a> <a href="/tags/栈帧/" style="font-size: 10px;">栈帧</a> <a href="/tags/栈溢出/" style="font-size: 10px;">栈溢出</a> <a href="/tags/根设备/" style="font-size: 10px;">根设备</a> <a href="/tags/母板/" style="font-size: 10px;">母板</a> <a href="/tags/汇编/" style="font-size: 10px;">汇编</a> <a href="/tags/浮点数/" style="font-size: 10px;">浮点数</a> <a href="/tags/消息摘要/" style="font-size: 10px;">消息摘要</a> <a href="/tags/特权级/" style="font-size: 10px;">特权级</a> <a href="/tags/环境变量/" style="font-size: 10px;">环境变量</a> <a href="/tags/生成器/" style="font-size: 14.55px;">生成器</a> <a href="/tags/用户栈/" style="font-size: 10px;">用户栈</a> <a href="/tags/相似度/" style="font-size: 10.91px;">相似度</a> <a href="/tags/硬盘/" style="font-size: 12.73px;">硬盘</a> <a href="/tags/硬链接/" style="font-size: 10px;">硬链接</a> <a href="/tags/管道/" style="font-size: 10px;">管道</a> <a href="/tags/系统调用/" style="font-size: 10px;">系统调用</a> <a href="/tags/索引/" style="font-size: 10px;">索引</a> <a href="/tags/缓冲区/" style="font-size: 10.91px;">缓冲区</a> <a href="/tags/缓冲区溢出/" style="font-size: 10px;">缓冲区溢出</a> <a href="/tags/缺页中断/" style="font-size: 10px;">缺页中断</a> <a href="/tags/网络/" style="font-size: 13.64px;">网络</a> <a href="/tags/翻译/" style="font-size: 14.55px;">翻译</a> <a href="/tags/虚拟地址空间/" style="font-size: 10px;">虚拟地址空间</a> <a href="/tags/虚拟盘/" style="font-size: 10px;">虚拟盘</a> <a href="/tags/请求项/" style="font-size: 10px;">请求项</a> <a href="/tags/质数/" style="font-size: 10px;">质数</a> <a href="/tags/超级块/" style="font-size: 10px;">超级块</a> <a href="/tags/软盘/" style="font-size: 10px;">软盘</a> <a href="/tags/软链接/" style="font-size: 10px;">软链接</a> <a href="/tags/进程派生/" style="font-size: 10px;">进程派生</a> <a href="/tags/进程通信/" style="font-size: 10.91px;">进程通信</a> <a href="/tags/迭代器/" style="font-size: 10px;">迭代器</a> <a href="/tags/金融/" style="font-size: 10px;">金融</a> <a href="/tags/阻塞/" style="font-size: 10.91px;">阻塞</a> <a href="/tags/非阻塞/" style="font-size: 10.91px;">非阻塞</a> <a href="/tags/黑客/" style="font-size: 10px;">黑客</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">谢宏峰，毕业于暨南大学（2009 - 2013）、中国科学院（2013 - 2016），现就职于深信服科技，从事 OpenStack 开发。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Max</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/author.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Max</h1>
			</hgroup>
			
			<p class="header-subtitle">Stay hungry, stay foolish.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/categories/架构">架构</a></li>
		        
					<li><a href="/categories/读书">读书</a></li>
		        
					<li><a href="/tags/翻译">翻译</a></li>
		        
					<li><a href="/categories/网络">网络</a></li>
		        
					<li><a href="/categories/并发">并发</a></li>
		        
					<li><a href="/categories/安全">安全</a></li>
		        
					<li><a href="/categories/运维">运维</a></li>
		        
					<li><a href="/categories/数据库">数据库</a></li>
		        
					<li><a href="/categories/云计算">云计算</a></li>
		        
					<li><a href="/categories/编程语言">编程语言</a></li>
		        
					<li><a href="/categories/操作系统">操作系统</a></li>
		        
					<li><a href="/categories/机器学习">机器学习</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xiehongfeng100" title="github">github</a>
			        
						<a class="linkedin" target="_blank" href="http://cn.linkedin.com/in/xiehongfeng100" title="linkedin">linkedin</a>
			        
						<a class="mail" target="_blank" href="mailto:xiehongfeng100@hotmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-openstack-theres-real-magic-behind-openstack-neutron" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/21/openstack-theres-real-magic-behind-openstack-neutron/" class="article-date">
  	<time datetime="2016-08-21T13:55:24.000Z" itemprop="datePublished">2016-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      【译】 OpenStack Neutron 背后的真正魔法
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Neutron/">Neutron</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenStack/">OpenStack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenVSwitch/">OpenVSwitch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/翻译/">翻译</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/云计算/">云计算</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>原文：</strong><a href="https://pinrojas.com/2014/07/29/theres-real-magic-behind-openstack-neutron/" target="_blank" rel="noopener">THERE’S REAL MAGIC BEHIND OPENSTACK NEUTRON</a><br><strong>译注：</strong>这篇博文基于 OpenStack IceHouse 版本写成。看完原文，直感到醍醐灌顶，也因此产生了翻译此文的冲动。说实话，本文的图画的很好，但有些地方逻辑却是很乱或者过于啰嗦。所以本文在必要的时候会进行一定意译，以使逻辑更为通顺。作为个人第一次科技博文翻译，定会存在各种瑕疵，敬请多多指出。</p>
<p>在任何博客网站上创建博文是相当容易的事。通过在笔记本电脑、手机或者平板电脑上几下鼠标点击，或者通过转发别人的博客就能够做到，最困难的在于对博文内容的思考。类比到 OpenStack，同样通过几下鼠标点击就可以创建虚拟机、路由器、子网、防火墙、VPN、负载均衡器（Load Balancer）。不过，首先，需要规划并想好为什么需要创建它们，而不仅仅因为能够创建而创建它们。基于这些虚拟设备所要支持的应用，还需要定义虚拟 IT 架构。</p>
<p>在我之前有关 Neutron 的<a href="https://pinrojas.com/2014/07/22/neutron-makes-easier-to-get-layer-3-at-your-service/" target="_blank" rel="noopener">博文</a>中，提到 Neutron 所具备的 L3 功能，且对其的创建和管理也很容易。现在，我将在本文中描述着背后的魔法。我确信你将会跟我一样喜爱它。OpenStack Neutron 充分应用了 SDN（Software Defined Network），其中最常用的第三方插件是 OpenVSwitch。 </p>
<p>首先，我想要提下，OpenStack 赞助商和社区贡献者已经提供了很多信息：</p>
<ul>
<li>来自 RedHat 的 <a href="https://www.rdoproject.org/networking/networking-in-too-much-detail/" target="_blank" rel="noopener">Networking in too much detail</a> 博文</li>
<li>OpenStack 官方文档 <a href="https://www.rdoproject.org/networking/networking-in-too-much-detail/" target="_blank" rel="noopener">Networking Docs</a></li>
</ul>
<a id="more"></a>
<h1 id="Nova-计算节点"><a href="#Nova-计算节点" class="headerlink" title="Nova 计算节点"></a><strong>Nova 计算节点</strong></h1><p>让我们从部署有 Neutron 和 OpenVSwitch 的 Nova 计算节点开始谈起。在这里，我们拥有一些虚拟机，网络流量从它们开始也最终结束于它们。这些虚拟机都依附有一个以太网虚拟网卡接口 <code>tap</code> 设备。这些 <code>tap</code> 设备在虚拟中被定义为逻辑网络接口 <code>eth0</code>。这些 <code>tap</code> 设备直接连接到 Linux 网桥（Linux Bridge）。在这些网桥上，通过 IPTables 定义了 OpenStack 的安全组（Security Group）。对每一个虚拟机而言，Linux 网桥是透明的，并且每一个安全组只能关联到一个虚拟机上。一个 Linux 网桥就是运行在 Linux 网络栈（Linux Network Stack）中的包含 IPTables 的进程，而一个网络栈包含了通过第 2 或 3 网络协议层连接到其他系统的最少网络资源。</p>
<p><strong>译注：</strong></p>
<ul>
<li>按照博文 <a href="http://www.ibm.com/developerworks/cn/linux/l-virtual-networking/" target="_blank" rel="noopener">Linux 中的虚拟网络</a>的说法，TAP 是一个虚拟网络内核驱动，该驱动实现 Ethernet 设备，并在 Ethernet 框架级别操作。TAP 驱动提供了 Ethernet “tap”，访客 Ethernet 框架能够通过它进行通信。也就是说，实际上，<code>tap 设备就是一个软件定义出来网卡设备，在虚拟机中被定义为逻辑接口 eth0。</code></li>
<li>对于为什么要额外增加一个 Linux 网桥，博文 <a href="http://panpei.net.cn/2013/12/04/openstack-neutron-mechanism-introduce/" target="_blank" rel="noopener">OpenStack Neutron运行机制解析概要</a>有一个比较不错的解释：<a href="http://docs.openstack.org/admin-guide/index.html" target="_blank" rel="noopener">Ideally, the TAP device vnet0 would be connected directly to the integration bridge, br-int. Unfortunately, this isn’t possible because of how OpenStack security groups are currently implemented. OpenStack uses iptables rules on the TAP devices such as vnet0 to implement security groups, and Open vSwitch is not compatible with iptables rules that are applied directly on TAP devices that are connected to an Open vSwitch port.</a> 其实就是说，<code>OpenvSwitch 不支持现在的 OpenStack 的实现方式，因为 OpenStack 是把 IPTables 规则丢在 TAP 设备中，以此实现了安全组功能。没办法，所以用了一个折衷的方式，在中间加一层，用 Linux Bridge 来实现吧，这样，就莫名其妙了多了一个 qbr 网桥。</code></li>
</ul>
<p><img src="/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-1.jpg" alt>  </p>
<p>OpenVSwitch 网桥跟 Linux 网桥并不兼容，那就在我们的架构中定义一对接口，叫做 <code>qbr</code> 和 <code>qvo</code>。qbr 直接连接到 Linux 网桥，qvo 连接到集成网桥（Integration Bridge）。集成网桥是 OpenVSwitch 解决方案的一部分，负责对进出该网桥的报文添加 VLAN 标签（tag） 或者去除 Vlan 标签。它同时也负责连接属于同一个租户的所有虚拟机，或者转发报文到隧道网桥（Tunnel Bridge）以最终转发到外部设备。</p>
<p><img src="/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-2.jpg" alt>  </p>
<p>隧道网桥（br-tun）通过 <code>patch-in</code> 接口连接到集成网桥（br-int）。OpenFlow 定义了通过该网桥中的隧道的报文处理规则。隧道是通过 GRE 定义。每一个 GRE 隧道 ID 都会关联到一个 Vlan ID。</p>
<p><strong>译注：</strong><a href="http://fishcried.com/2016-02-09/openvswitch-ops-guide/" target="_blank" rel="noopener"><code>patch-in</code></a> 指的是 OpenVSwitch 中用于连接两个网桥的接口</p>
<p><img src="/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-3.jpg" alt>  </p>
<h1 id="架顶式（Top-of-Rack-TOR）和核心云交换机"><a href="#架顶式（Top-of-Rack-TOR）和核心云交换机" class="headerlink" title="架顶式（Top of Rack, TOR）和核心云交换机"></a><strong>架顶式（Top of Rack, TOR）和核心云交换机</strong></h1><p>所有的节点（控制、计算、网络节点等等）通过高性能交换机连接在一起。这个架构在控制虚拟资源之间的数据流通的好处在于这些交换机只提供了第 2 层的数据运输，仅仅需要一个主 VLAN 来分隔内部和外部报文——可能都不需要 2 个。</p>
<p>我们也不需要提供高级的路由、GRE、安全这些组件，它们都由 Neutron 和 OpenVSwitch 来提供。另外，我们不受供应商的束缚——至少我们能够开始使用一些专门插件，以管理硬件或其他电气设备。那么，我们就可以使用来自不同供应商的数据管理平台，以处理大数据和达到低延迟。</p>
<p><img src="/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-4.jpg" alt>  </p>
<h1 id="Neutron-网络节点"><a href="#Neutron-网络节点" class="headerlink" title="Neutron 网络节点"></a><strong>Neutron 网络节点</strong></h1><p>Neutron 节点是单独的主机，在该主机上运行了更高级的网络服务或模块（如路由器、DHCP、防火墙）。所有通过 GRE 隧道从 Nova 主机到达外部网络（或者互联网）的流量都结束于 Neutron 节点定义的 br-tun 网桥。br-tun 上实施了 OpenFlow 规则，这些规则定义了 VLAN ID 和 GRE 隧道 ID 之间的匹配，并且 VLAN 和 GRE 之间的转换也发生在此网桥上。这个网桥在 Neutron 节点中通过 patch-in 接口连接到集成网桥（br-int）上。</p>
<p><img src="/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-5.jpg" alt>  </p>
<p>在 Neutron 节点上，br-int 网桥对来往路由器和 DNSMasq 的报文打标签或去除标签。路由器和 DNSMasq 都有自己独立的命名空间和 Linux 网络栈。命名空间允许关联到不同租户的存在重叠地址空间的路由器之间的流量交互。路由器则在租户的子网之间转发流量和接收或发送外部网络的流量。同样，这些路由器也使用 Linux IPTables 来过滤流量和实现浮动 IP 与 虚拟机之间的 NAT（Network Address Translation）功能。DNSMasq 同样工作在 Linux 网络栈，提供的 DHCP 和 DNS 进程只专门服务于关联的租户。</p>
<p><img src="/images/cloud-computation/openstack/neutron/magic-behind-neutron/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-6.jpg" alt>  </p>
<p><strong>译注：</strong>博文 <a href="http://panpei.net.cn/2013/12/04/openstack-neutron-mechanism-introduce/" target="_blank" rel="noopener">OpenStack Neutron运行机制解析概要</a>对虚拟网桥 br-ex 有一个简要说明：<code>br-ex 实际上是混杂模式加载在物理网卡上，实时接收着网络上的数据包。</code>至此，我们的计算节点上的 VM 就可以与外部的网络进行自由的通信了。当然，前提是我们要给这个 VM 已经分配了float-ip。</p>
<h1 id="设计-Neutron-OVS-架构的关键点"><a href="#设计-Neutron-OVS-架构的关键点" class="headerlink" title="设计 Neutron+OVS 架构的关键点"></a><strong>设计 Neutron+OVS 架构的关键点</strong></h1><p>Neutron 包含了路由器、基础/高级网络和安全服务，并且几乎所有的数据都会经过 Neutron 节点，所以尽最大可能给这些节点增加内存。内存是最常用的资源。同时考虑至少配置两个拥有一样配置的主机，利用其中一个作为另外一个的备份。</p>
<p>采用高性能的交换机同样很重要，因为 OpenStack 节点之间存在大规模数据交互；为云数据交换设计至少两层协议栈；尝试将同一租户的虚拟机之间的流量限制在同一空间内——几乎所有的流量都会在架顶式交换机（TOR）之间流通。</p>
<p>就这样，下次见！</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/23/openstack-request-flow-for-provisioning-instance-in-openstack/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          【译】 OpenStack 中虚拟机创建的请求流程
        
      </div>
    </a>
  
  
    <a href="/2016/07/17/ccplusplus-macro-define-advanced-features/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">宏 define 的高级特性：预处理运算符 “#” 及 “##”</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>







      <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>

<script>
var gitalk = new Gitalk({
  clientID: '64c19d7f57bebbb343c4',
  clientSecret: '287daeba39e73fdde92f24540c9f3c0fd5238512',
  repo: 'BlogComments',
  owner: 'xiemax100',
  admin: ['xiemax100'],
  id: md5(window.location.pathname),
  distractionFreeMode: true
})

gitalk.render('gitalk-container')
</script>






    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nova-计算节点"><span class="toc-number">1.</span> <span class="toc-text">Nova 计算节点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#架顶式（Top-of-Rack-TOR）和核心云交换机"><span class="toc-number">2.</span> <span class="toc-text">架顶式（Top of Rack, TOR）和核心云交换机</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Neutron-网络节点"><span class="toc-number">3.</span> <span class="toc-text">Neutron 网络节点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#设计-Neutron-OVS-架构的关键点"><span class="toc-number">4.</span> <span class="toc-text">设计 Neutron+OVS 架构的关键点</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var toc_button = document.getElementById("tocButton");
    var toc_div = document.getElementById("toc");
    toc_button.onclick=function() {
        if (toc_div.style.display == "none") {
            toc_div.style.display = "block";
            toc_button.value = "隐藏目录";
            document.getElementById("switch-btn").style.display = "none";
            document.getElementById("switch-area").style.display = "none";
        }
        else {
            toc_div.style.display = "none";
            toc_button.value = "显示目录";
            document.getElementById("switch-btn").style.display = "block";
            document.getElementById("switch-area").style.display = "block";
        }
    }

    if ($(".toc").length < 1) {
        $("#toc").css("display","none");
        $("#tocButton").css("display","none");
        $(".switch-btn").css("display","block");
        $(".switch-area").css("display","block");
    }
</script>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2020 Max
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>