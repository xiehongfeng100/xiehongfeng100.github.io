<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>MySQL 索引 | Max&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文如无特殊说明，所有内容均是针对 InnoDB 存储引擎而言。 首先，确保我们正在使用的 MySQL 引擎是 InnoDB（Support 行为 DEFAULT）：123456789101112131415mysql&amp;gt; show engines;+--------------------+---------+-----------------------------------------">
<meta name="keywords" content="MySQL,InnoDB,索引,B+ 树">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 索引">
<meta property="og:url" content="http://xiehongfeng100.github.io/2017/08/02/mysql-index/index.html">
<meta property="og:site_name" content="Max&#39;s Blog">
<meta property="og:description" content="本文如无特殊说明，所有内容均是针对 InnoDB 存储引擎而言。 首先，确保我们正在使用的 MySQL 引擎是 InnoDB（Support 行为 DEFAULT）：123456789101112131415mysql&amp;gt; show engines;+--------------------+---------+-----------------------------------------">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/database/mysql/index/b-tree-overview.png">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/database/mysql/index/clustered-index-data-structure.png">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/database/mysql/index/secondary-index-data-structure.png">
<meta property="og:image" content="http://xiehongfeng100.github.io/images/database/mysql/index/clustered-secondary-index-data-structure-diff.png">
<meta property="og:updated_time" content="2019-05-01T06:47:11.044Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL 索引">
<meta name="twitter:description" content="本文如无特殊说明，所有内容均是针对 InnoDB 存储引擎而言。 首先，确保我们正在使用的 MySQL 引擎是 InnoDB（Support 行为 DEFAULT）：123456789101112131415mysql&amp;gt; show engines;+--------------------+---------+-----------------------------------------">
<meta name="twitter:image" content="http://xiehongfeng100.github.io/images/database/mysql/index/b-tree-overview.png">
  
    <link rel="alternative" href="/atom.xml" title="Max&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/author.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Max</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Stay hungry, stay foolish.</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/categories/读书">读书</a></li>
				        
							<li><a href="/tags/翻译">翻译</a></li>
				        
							<li><a href="/categories/网络">网络</a></li>
				        
							<li><a href="/categories/并发">并发</a></li>
				        
							<li><a href="/categories/安全">安全</a></li>
				        
							<li><a href="/categories/运维">运维</a></li>
				        
							<li><a href="/categories/数据库">数据库</a></li>
				        
							<li><a href="/categories/云计算">云计算</a></li>
				        
							<li><a href="/categories/编程语言">编程语言</a></li>
				        
							<li><a href="/categories/操作系统">操作系统</a></li>
				        
							<li><a href="/categories/机器学习">机器学习</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/xiehongfeng100" title="github">github</a>
					        
								<a class="linkedin" target="_blank" href="http://cn.linkedin.com/in/xiehongfeng100" title="linkedin">linkedin</a>
					        
								<a class="mail" target="_blank" href="mailto:xiehongfeng100@yeah.net" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/tmp/" style="font-size: 10px;">/tmp</a> <a href="/tags/AT-T/" style="font-size: 10px;">AT&T</a> <a href="/tags/Affin/" style="font-size: 10px;">Affin</a> <a href="/tags/Alembic/" style="font-size: 10px;">Alembic</a> <a href="/tags/B-树/" style="font-size: 10px;">B+ 树</a> <a href="/tags/BIOS/" style="font-size: 10px;">BIOS</a> <a href="/tags/C-C/" style="font-size: 16.36px;">C/C++</a> <a href="/tags/CA/" style="font-size: 10px;">CA</a> <a href="/tags/CBOW/" style="font-size: 10px;">CBOW</a> <a href="/tags/CNN/" style="font-size: 10.91px;">CNN</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/Decorator/" style="font-size: 10px;">Decorator</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Dnsmasq/" style="font-size: 10px;">Dnsmasq</a> <a href="/tags/ELF/" style="font-size: 10px;">ELF</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Elasticsearch/" style="font-size: 11.82px;">Elasticsearch</a> <a href="/tags/GCC/" style="font-size: 10px;">GCC</a> <a href="/tags/HBR/" style="font-size: 10px;">HBR</a> <a href="/tags/IO-Multiplexing/" style="font-size: 11.82px;">IO Multiplexing</a> <a href="/tags/IPTables/" style="font-size: 10px;">IPTables</a> <a href="/tags/Immunity-Debugger/" style="font-size: 10px;">Immunity Debugger</a> <a href="/tags/InnoDB/" style="font-size: 10px;">InnoDB</a> <a href="/tags/KD-Tree/" style="font-size: 10.91px;">KD-Tree</a> <a href="/tags/KNN/" style="font-size: 10px;">KNN</a> <a href="/tags/KVM/" style="font-size: 10px;">KVM</a> <a href="/tags/Kali-Linux/" style="font-size: 10px;">Kali Linux</a> <a href="/tags/Keras/" style="font-size: 10px;">Keras</a> <a href="/tags/Keystone/" style="font-size: 13.64px;">Keystone</a> <a href="/tags/Kibana/" style="font-size: 10px;">Kibana</a> <a href="/tags/Lemmatization/" style="font-size: 10px;">Lemmatization</a> <a href="/tags/Libvirt/" style="font-size: 10.91px;">Libvirt</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/LinuxBridge/" style="font-size: 11.82px;">LinuxBridge</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/Logstash/" style="font-size: 10px;">Logstash</a> <a href="/tags/MRO/" style="font-size: 10px;">MRO</a> <a href="/tags/Metasploit-Framwork/" style="font-size: 10px;">Metasploit Framwork</a> <a href="/tags/MySQL/" style="font-size: 10.91px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Namespace/" style="font-size: 10px;">Namespace</a> <a href="/tags/Neo4J/" style="font-size: 10.91px;">Neo4J</a> <a href="/tags/Neutron/" style="font-size: 13.64px;">Neutron</a> <a href="/tags/Nova/" style="font-size: 14.55px;">Nova</a> <a href="/tags/OpenStack/" style="font-size: 17.27px;">OpenStack</a> <a href="/tags/OpenVSwitch/" style="font-size: 10px;">OpenVSwitch</a> <a href="/tags/PKI/" style="font-size: 10.91px;">PKI</a> <a href="/tags/PasteDeploy/" style="font-size: 10.91px;">PasteDeploy</a> <a href="/tags/Policy/" style="font-size: 10px;">Policy</a> <a href="/tags/Python/" style="font-size: 18.18px;">Python</a> <a href="/tags/QEMU/" style="font-size: 10px;">QEMU</a> <a href="/tags/RBAC/" style="font-size: 10px;">RBAC</a> <a href="/tags/RPC/" style="font-size: 10px;">RPC</a> <a href="/tags/SQLAlchemy-Migrate/" style="font-size: 10px;">SQLAlchemy-Migrate</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/Sigmoid/" style="font-size: 10px;">Sigmoid</a> <a href="/tags/Skip-Gram/" style="font-size: 10px;">Skip-Gram</a> <a href="/tags/Socket/" style="font-size: 10px;">Socket</a> <a href="/tags/Stop-Words/" style="font-size: 10px;">Stop Words</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Tap/" style="font-size: 10.91px;">Tap</a> <a href="/tags/Token/" style="font-size: 11.82px;">Token</a> <a href="/tags/Tokenization/" style="font-size: 10px;">Tokenization</a> <a href="/tags/Trampolining/" style="font-size: 10px;">Trampolining</a> <a href="/tags/Tun/" style="font-size: 10.91px;">Tun</a> <a href="/tags/Tunnel/" style="font-size: 10px;">Tunnel</a> <a href="/tags/UUID/" style="font-size: 10px;">UUID</a> <a href="/tags/VNC/" style="font-size: 10px;">VNC</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/Veth/" style="font-size: 11.82px;">Veth</a> <a href="/tags/VirtualBox/" style="font-size: 10px;">VirtualBox</a> <a href="/tags/Vlan/" style="font-size: 10px;">Vlan</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/WSGI/" style="font-size: 13.64px;">WSGI</a> <a href="/tags/Webob/" style="font-size: 10px;">Webob</a> <a href="/tags/Word2Vec/" style="font-size: 10.91px;">Word2Vec</a> <a href="/tags/Yelper/" style="font-size: 15.45px;">Yelper</a> <a href="/tags/bootsect/" style="font-size: 10px;">bootsect</a> <a href="/tags/cookiecutter/" style="font-size: 10px;">cookiecutter</a> <a href="/tags/delete/" style="font-size: 10px;">delete</a> <a href="/tags/dnsmasq/" style="font-size: 10px;">dnsmasq</a> <a href="/tags/entry-points/" style="font-size: 10px;">entry_points</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/fork/" style="font-size: 10px;">fork</a> <a href="/tags/head/" style="font-size: 10px;">head</a> <a href="/tags/inode/" style="font-size: 10px;">inode</a> <a href="/tags/malloc/" style="font-size: 10px;">malloc</a> <a href="/tags/mona/" style="font-size: 10px;">mona</a> <a href="/tags/new/" style="font-size: 10px;">new</a> <a href="/tags/property/" style="font-size: 10px;">property</a> <a href="/tags/read/" style="font-size: 10px;">read</a> <a href="/tags/routes/" style="font-size: 10px;">routes</a> <a href="/tags/select/" style="font-size: 10px;">select</a> <a href="/tags/setup/" style="font-size: 10px;">setup</a> <a href="/tags/setuptools/" style="font-size: 10px;">setuptools</a> <a href="/tags/shell/" style="font-size: 10.91px;">shell</a> <a href="/tags/stevedore/" style="font-size: 10px;">stevedore</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/tcpdump/" style="font-size: 10px;">tcpdump</a> <a href="/tags/uWSGI/" style="font-size: 10px;">uWSGI</a> <a href="/tags/update-进程/" style="font-size: 10px;">update 进程</a> <a href="/tags/write/" style="font-size: 10px;">write</a> <a href="/tags/wsgiref/" style="font-size: 10px;">wsgiref</a> <a href="/tags/yield/" style="font-size: 14.55px;">yield</a> <a href="/tags/中断/" style="font-size: 10.91px;">中断</a> <a href="/tags/任务调度/" style="font-size: 10px;">任务调度</a> <a href="/tags/传记/" style="font-size: 10.91px;">传记</a> <a href="/tags/信号/" style="font-size: 10px;">信号</a> <a href="/tags/信号量/" style="font-size: 10px;">信号量</a> <a href="/tags/内存对齐/" style="font-size: 10px;">内存对齐</a> <a href="/tags/内存映射-I-O/" style="font-size: 10px;">内存映射 I/O</a> <a href="/tags/内存规划/" style="font-size: 10px;">内存规划</a> <a href="/tags/内核/" style="font-size: 19.09px;">内核</a> <a href="/tags/内核栈/" style="font-size: 10px;">内核栈</a> <a href="/tags/分页/" style="font-size: 10px;">分页</a> <a href="/tags/加密/" style="font-size: 10.91px;">加密</a> <a href="/tags/加载/" style="font-size: 10.91px;">加载</a> <a href="/tags/协程/" style="font-size: 13.64px;">协程</a> <a href="/tags/可执行目标文件/" style="font-size: 10.91px;">可执行目标文件</a> <a href="/tags/可重定位目标文件/" style="font-size: 10px;">可重定位目标文件</a> <a href="/tags/同步/" style="font-size: 10px;">同步</a> <a href="/tags/商业/" style="font-size: 11.82px;">商业</a> <a href="/tags/地心坐标系/" style="font-size: 10px;">地心坐标系</a> <a href="/tags/多线程/" style="font-size: 10.91px;">多线程</a> <a href="/tags/多进程/" style="font-size: 10px;">多进程</a> <a href="/tags/字符串/" style="font-size: 10px;">字符串</a> <a href="/tags/存储器/" style="font-size: 10.91px;">存储器</a> <a href="/tags/宏/" style="font-size: 10px;">宏</a> <a href="/tags/寄存器/" style="font-size: 10px;">寄存器</a> <a href="/tags/开发环境/" style="font-size: 10px;">开发环境</a> <a href="/tags/异常/" style="font-size: 10px;">异常</a> <a href="/tags/异步/" style="font-size: 10px;">异步</a> <a href="/tags/引导块/" style="font-size: 10px;">引导块</a> <a href="/tags/引导程序/" style="font-size: 12.73px;">引导程序</a> <a href="/tags/归一化/" style="font-size: 10px;">归一化</a> <a href="/tags/微处理器/" style="font-size: 13.64px;">微处理器</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a> <a href="/tags/情感分析/" style="font-size: 10px;">情感分析</a> <a href="/tags/扩容/" style="font-size: 10px;">扩容</a> <a href="/tags/指令集/" style="font-size: 10px;">指令集</a> <a href="/tags/指针/" style="font-size: 12.73px;">指针</a> <a href="/tags/数字签名/" style="font-size: 10px;">数字签名</a> <a href="/tags/数字证书/" style="font-size: 10px;">数字证书</a> <a href="/tags/整数/" style="font-size: 10px;">整数</a> <a href="/tags/文件系统/" style="font-size: 12.73px;">文件系统</a> <a href="/tags/时钟/" style="font-size: 10px;">时钟</a> <a href="/tags/时钟中断/" style="font-size: 10px;">时钟中断</a> <a href="/tags/时间衰减函数/" style="font-size: 10px;">时间衰减函数</a> <a href="/tags/权限/" style="font-size: 10px;">权限</a> <a href="/tags/标准输入/" style="font-size: 10px;">标准输入</a> <a href="/tags/标准输出/" style="font-size: 10px;">标准输出</a> <a href="/tags/标准错误输出/" style="font-size: 10px;">标准错误输出</a> <a href="/tags/栈帧/" style="font-size: 10px;">栈帧</a> <a href="/tags/栈溢出/" style="font-size: 10px;">栈溢出</a> <a href="/tags/根设备/" style="font-size: 10px;">根设备</a> <a href="/tags/母板/" style="font-size: 10px;">母板</a> <a href="/tags/汇编/" style="font-size: 10px;">汇编</a> <a href="/tags/浮点数/" style="font-size: 10px;">浮点数</a> <a href="/tags/消息摘要/" style="font-size: 10px;">消息摘要</a> <a href="/tags/特权级/" style="font-size: 10px;">特权级</a> <a href="/tags/环境变量/" style="font-size: 10px;">环境变量</a> <a href="/tags/生成器/" style="font-size: 14.55px;">生成器</a> <a href="/tags/用户栈/" style="font-size: 10px;">用户栈</a> <a href="/tags/相似度/" style="font-size: 10.91px;">相似度</a> <a href="/tags/硬盘/" style="font-size: 12.73px;">硬盘</a> <a href="/tags/硬链接/" style="font-size: 10px;">硬链接</a> <a href="/tags/管道/" style="font-size: 10px;">管道</a> <a href="/tags/系统调用/" style="font-size: 10px;">系统调用</a> <a href="/tags/索引/" style="font-size: 10px;">索引</a> <a href="/tags/缓冲区/" style="font-size: 10.91px;">缓冲区</a> <a href="/tags/缓冲区溢出/" style="font-size: 10px;">缓冲区溢出</a> <a href="/tags/缺页中断/" style="font-size: 10px;">缺页中断</a> <a href="/tags/网络/" style="font-size: 13.64px;">网络</a> <a href="/tags/翻译/" style="font-size: 14.55px;">翻译</a> <a href="/tags/虚拟地址空间/" style="font-size: 10px;">虚拟地址空间</a> <a href="/tags/虚拟盘/" style="font-size: 10px;">虚拟盘</a> <a href="/tags/请求项/" style="font-size: 10px;">请求项</a> <a href="/tags/质数/" style="font-size: 10px;">质数</a> <a href="/tags/超级块/" style="font-size: 10px;">超级块</a> <a href="/tags/软盘/" style="font-size: 10px;">软盘</a> <a href="/tags/软链接/" style="font-size: 10px;">软链接</a> <a href="/tags/进程派生/" style="font-size: 10px;">进程派生</a> <a href="/tags/进程通信/" style="font-size: 10.91px;">进程通信</a> <a href="/tags/迭代器/" style="font-size: 10px;">迭代器</a> <a href="/tags/金融/" style="font-size: 10px;">金融</a> <a href="/tags/阻塞/" style="font-size: 10.91px;">阻塞</a> <a href="/tags/非阻塞/" style="font-size: 10.91px;">非阻塞</a> <a href="/tags/黑客/" style="font-size: 10px;">黑客</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">谢宏峰，毕业于暨南大学（2009 - 2013）、中国科学院（2013 - 2016），现就职于深信服科技，从事 OpenStack 开发。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Max</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/author.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Max</h1>
			</hgroup>
			
			<p class="header-subtitle">Stay hungry, stay foolish.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/categories/读书">读书</a></li>
		        
					<li><a href="/tags/翻译">翻译</a></li>
		        
					<li><a href="/categories/网络">网络</a></li>
		        
					<li><a href="/categories/并发">并发</a></li>
		        
					<li><a href="/categories/安全">安全</a></li>
		        
					<li><a href="/categories/运维">运维</a></li>
		        
					<li><a href="/categories/数据库">数据库</a></li>
		        
					<li><a href="/categories/云计算">云计算</a></li>
		        
					<li><a href="/categories/编程语言">编程语言</a></li>
		        
					<li><a href="/categories/操作系统">操作系统</a></li>
		        
					<li><a href="/categories/机器学习">机器学习</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xiehongfeng100" title="github">github</a>
			        
						<a class="linkedin" target="_blank" href="http://cn.linkedin.com/in/xiehongfeng100" title="linkedin">linkedin</a>
			        
						<a class="mail" target="_blank" href="mailto:xiehongfeng100@yeah.net" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-mysql-index" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/08/02/mysql-index/" class="article-date">
  	<time datetime="2017-08-02T14:31:22.000Z" itemprop="datePublished">2017-08-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MySQL 索引
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/B-树/">B+ 树</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/InnoDB/">InnoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/索引/">索引</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/数据库/">数据库</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文如无特殊说明，所有内容均是针对 InnoDB 存储引擎而言。</p>
<p>首先，确保我们正在使用的 MySQL 引擎是 InnoDB（Support 行为 DEFAULT）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |</span><br><span class="line">| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |</span><br><span class="line">| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |</span><br><span class="line">| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |</span><br><span class="line">| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |</span><br><span class="line">| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>本文样例均在以下 MySQL 版本中测试通过：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.6.22, for Linux (x86_64) using  EditLine wrapper</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a><strong>索引</strong></h1><p>注意，<code>索引在 MySQL 中也被称为键（key）</code>。而且，<code>InnoDB 中的主键、Unique 键底层都是使用索引来实现的。</code></p>
<h2 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a><strong>索引</strong></h2><p>关于索引，<a href="https://dev.mysql.com/doc/refman/5.6/en/mysql-indexes.html" target="_blank" rel="noopener">MySQL 官方文档</a>说的很清晰：</p>
<blockquote>
<p>Indexes are used to find rows with specific column values quickly. Without an index, MySQL must begin with the first row and then read through the entire table to find the relevant rows. The larger the table, the more this costs. If the table has an index for the columns in question, MySQL can quickly determine the position to seek to in the middle of the data file without having to look at all the data. This is much faster than reading every row sequentially.</p>
</blockquote>
<p>也就是说，索引（Index）是用来加快查找速度的。如果没有索引，那么就需要对整个表进行扫描。随着表大小的增大，所耗时间也会随着增大。而如果有索引，我们就可以很快就定位到所需数据所在的数据文件，再进一步查找就要快很多了。<a href="https://tech.meituan.com/" target="_blank" rel="noopener">美团点评技术团队博客</a>的一篇文章 <a href="https://tech.meituan.com/mysql-index.html" target="_blank" rel="noopener">MySQL 索引原理及慢查询优化</a>的一个例子就解释的很通俗易懂：</p>
<blockquote>
<p>可以类比字典，如果要查 “mysql” 这个单词，我们肯定需要定位到 m 字母，然后从下往下找到 y 字母，再找到剩下的 sql。如果没有索引，那么你可能需要把所有单词看一遍才能找到你想要的。</p>
</blockquote>
<p>从这个例子，我们也可以看到，<code>利用索引的查询其实是一步步缩小查询范围的</code>；而且根据《MySQL 技术内幕：InnoDB 存储引擎（第 2 版）》一书，InnoDB 引擎的索引基于 B+ 树实现，</p>
<blockquote>
<p>B+ 树索引并不能找到一个给定键值的具体行。<code>B+ 树索引能找到的只是被查找数据行所在的页。然后数据库通过把页读入到内存，再在内存中进行查找，最后得到要查找的数据。</code></p>
</blockquote>
<p>这跟字典查单词过程确实很像，我们先由开头的字母一步步缩小查询，最后定位到一页（或几页），再在这一页（几页）查找到我们想要的单词。</p>
<p>可见，<code>索引是存储引擎用于快速找到数据的一种数据结构（B+ 树）</code>。</p>
<p>不过，索引也不是什么时候都适用的。当我们需要获取的数据较多，同时利用索引会导致较多的磁盘 I/O，这样 MySQL 优化器并不会使用索引，而是批量从磁盘读取数据到内存，然后再处理。因为这时从磁盘顺序读的效率要比多次磁盘 I/O 效率高。可见<a href="https://dev.mysql.com/doc/refman/5.6/en/mysql-indexes.html" target="_blank" rel="noopener">官方文档</a>解释：</p>
<blockquote>
<p>Indexes are less important for queries on small tables, or big tables where report queries process most or all of the rows. When a query needs to access most of the rows, reading sequentially is faster than working through an index. Sequential reads minimize disk seeks, even if not all the rows are needed for the query.</p>
</blockquote>
<h2 id="B-树简介"><a href="#B-树简介" class="headerlink" title="B+ 树简介"></a><strong>B+ 树简介</strong></h2><p>B 树通常意味着<code>所有的值都是按顺序存储</code>的，并且<code>每一个叶子页到根的距离相同</code>。下图展示了 B-Tree 索引的抽象表示，大致反映了 InnoDB 索引是如何工作的：<br><img src="/images/database/mysql/index/b-tree-overview.png" alt>图片来源：《高性能 MySQL（第 3 版）》  </p>
<p>更多详细关于 B+ 树介绍请参考《MySQL 技术内幕：InnoDB 存储引擎（第 2 版）》第 5.3 节。</p>
<h1 id="聚集索引和辅助索引"><a href="#聚集索引和辅助索引" class="headerlink" title="聚集索引和辅助索引"></a><strong>聚集索引和辅助索引</strong></h1><p>InnoDB 中的索引有两种——聚集索引（Clusted Index）和辅助索引（Secondary Index）。他们都是基于 B+ 树构建。</p>
<h2 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a><strong>聚集索引</strong></h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong>简介</strong></h3><p>每一个 InnoDB 表都有唯一一个特殊的索引——聚集索引。它是按照每张表的主键构造的一颗 B+ 树，叶子节点存放即位整张表的行记录（record）。</p>
<p>按 <a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-index-types.html" target="_blank" rel="noopener">MySQL 官方文档</a>，聚集索引的构造有三种方式：</p>
<ul>
<li>如果表中定义了主键，那 InnoDB 引擎就会使用该主键为聚集索引。</li>
<li>如果表中没有定义主键，那 InnoDB 引擎就会将找到的第一个非 NULL 的 UNIQUE 索引（列）作为聚集索引。</li>
<li>如果表中没有定义主键也没有合适的 UNIQUE 索引，InnoDB 引擎会内部创建一个隐藏的聚集索引。 </li>
</ul>
<p>样例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 主键聚集索引</span><br><span class="line">mysql&gt; create table t1 (id int not null, name varchar(10), primary key (id));</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; show index from t1\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">        Table: t1</span><br><span class="line">   Non_unique: 0</span><br><span class="line">     Key_name: PRIMARY</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: id</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null: </span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line"># Unique 聚集索引</span><br><span class="line">mysql&gt; create table t2 (id int not null, name varchar(10), unique key (id));</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; show index from t2\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">        Table: t2</span><br><span class="line">   Non_unique: 0</span><br><span class="line">     Key_name: id</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: id</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null: </span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 隐藏的聚集索引</span><br><span class="line">mysql&gt; create table t3 (id int not null, name varchar(10));</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show index from t3\G;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="磁盘存储"><a href="#磁盘存储" class="headerlink" title="磁盘存储"></a><strong>磁盘存储</strong></h3><p>对于聚集索引，《高性能 MySQL（第 3 版）》的说明最本质：</p>
<blockquote>
<p>聚簇索引并不是一种单独的索引类型，而是<code>一种数据存储方式</code>。具体的细节依赖于某实现方式，但 InnoDB 的聚簇索引实际上是在同一个结构中保存了 B-Tree 索引和数据行。<br>当表有聚簇索引时，它的数据行实际上存放在索引的叶子叶（leaf page）中。<code>术语“聚簇”表示数据行和相邻的键值紧凑的存储在一起。</code>因为无法同时把数据行存放在两个不同的地方，所以一个表只能有一个聚簇索引。</p>
</blockquote>
<p>这也就是说，聚簇索引有如下两个优点：</p>
<blockquote>
<p>可以把相关数据保存在一起。例如实现电子邮箱时，可以根据用户 ID 来聚集数据，这样只需要从磁盘读取少数的数据页就能获取某个用户的全部邮件。如果没有使用聚簇索引，则每封邮件获取都可能导致一次磁盘 I/O。<br>数据访问更快。聚簇索引将索引和数据保存在同一个 B-Tree 中，因此从聚簇索引中获取数据通常比在非聚簇索引中查找更快。</p>
</blockquote>
<p>从以上描述，我们可以看到，聚集索引的目的之一就在于减少磁盘 I/O 来提升数据获取效率；另外，通过将索引和数据存在在一起来加快数据获取。</p>
<p>在《高性能 MySQL（第 3 版）》一书中，作者并没有说聚集索引在磁盘是否顺序存放，而是说“数据行和相邻的键值紧凑的存储在一起”。这跟我们平常看到的“聚集索引按照顺序物理地存储数据”不一样。哪一种更加准确，个人更加倾向于前者，因为我们可以在《MySQL 技术内幕：InnoDB 存储引擎（第 2 版）》一书找到证据：</p>
<blockquote>
<p>如果聚集索引必须按照特定顺序存放物理记录，则维护成本显得非常之高。所以，<code>聚集索引的存储并不是物理上连续的，而是逻辑上连续的。</code>这其中有两点：一是前面说过的页通过双向链表链接，页按照主键的顺序排序；另一点是每个页中的记录也是通过双向链表进行维护的，物理存储上可以同样不按照主键存储。</p>
</blockquote>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a><strong>数据结构</strong></h3><p>聚集索引的数据结构就是一个 B+ 树，只不过这个 B+ 树把键值和数据（记录）一起存放。如《高性能 MySQL（第 3 版）》书中所示：<br><img src="/images/database/mysql/index/clustered-index-data-structure.png" alt>图片来源：《高性能 MySQL（第 3 版）》  </p>
<p>可以看出，聚集索引的每一个叶子节点都包含了主键值（col1）、事务 ID、用户事务的 MVCC 的回滚指针以及<code>所有的剩余列</code>（在这个例子中是 col2）。如果主键是一个列前缀索引，InnoDB 也会包含完整的主键列和剩下的其他列。</p>
<p>由此也可以看出，InnoDB 中，聚集索引“就是”表。</p>
<h2 id="辅助索引"><a href="#辅助索引" class="headerlink" title="辅助索引"></a><strong>辅助索引</strong></h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a><strong>简介</strong></h3><p>除了聚集索引之外的索引都叫辅助索引（<a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-index-types.html" target="_blank" rel="noopener">All indexes other than the clustered index are known as secondary indexes.</a>）。所以辅助索引也称为非聚集索引。<code>它的叶子节点并不存放行记录数据，而是聚集索引建。</code>也就是说，要想获取行记录数据，利用辅助索引还需要聚集索引作为一个桥梁。那这是怎么做到的呢？看<a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-index-types.html" target="_blank" rel="noopener">官方文档</a>说明：</p>
<blockquote>
<p>In InnoDB, each record in a secondary index contains the primary key columns for the row, as well as the columns specified for the secondary index. InnoDB uses this primary key value to search for the row in the clustered index.</p>
</blockquote>
<p>也就是说，辅助索引其实不单单包括了自身所在行，还包括了主键所在的行！！！所以就是说，辅助索引（可能已经是一个联合索引）其实是和聚集索引一起构成了一个“联合索引”（称为索引扩展 <a href="https://dev.mysql.com/doc/refman/5.6/en/index-extensions.html" target="_blank" rel="noopener">Index Extensions</a>）。这里<a href="https://dev.mysql.com/doc/refman/5.6/en/index-extensions.html" target="_blank" rel="noopener">官方文档</a>就说的更加清楚了：</p>
<blockquote>
<p><code>InnoDB automatically extends each secondary index by appending the primary key columns to it.</code> Consider this table definition:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; CREATE TABLE t1 (</span><br><span class="line">&gt;   i1 INT NOT NULL DEFAULT 0,</span><br><span class="line">&gt;   i2 INT NOT NULL DEFAULT 0,</span><br><span class="line">&gt;   d DATE DEFAULT NULL,</span><br><span class="line">&gt;   PRIMARY KEY (i1, i2),</span><br><span class="line">&gt;   INDEX k_d (d)</span><br><span class="line">&gt; ) ENGINE = InnoDB;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>This table defines the primary key on columns (i1, i2). It also defines a secondary index k_d on column (d), but internally InnoDB extends this index and treats it as columns (d, i1, i2).</p>
</blockquote>
<p>也因此，如果主键的长度较大，这会使得辅助索引实际使用的空间很大，所以，要尽量选用长度较短的主键（<a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-index-types.html" target="_blank" rel="noopener">官方文档</a>）：</p>
<blockquote>
<p>If the primary key is long, the secondary indexes use more space, so it is advantageous to have a short primary key.</p>
</blockquote>
<p>样例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE t1 (</span><br><span class="line">    -&gt;   i1 INT NOT NULL DEFAULT 0,</span><br><span class="line">    -&gt;   i2 INT NOT NULL DEFAULT 0,</span><br><span class="line">    -&gt;   d DATE DEFAULT NULL,</span><br><span class="line">    -&gt;   PRIMARY KEY (i1, i2),</span><br><span class="line">    -&gt;   INDEX k_d (d)</span><br><span class="line">    -&gt; ) ENGINE = InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; INSERT INTO t1 VALUES</span><br><span class="line">    -&gt; (1, 1, &apos;1998-01-01&apos;), (1, 2, &apos;1999-01-01&apos;),</span><br><span class="line">    -&gt; (1, 3, &apos;2000-01-01&apos;), (1, 4, &apos;2001-01-01&apos;),</span><br><span class="line">    -&gt; (1, 5, &apos;2002-01-01&apos;), (2, 1, &apos;1998-01-01&apos;),</span><br><span class="line">    -&gt; (2, 2, &apos;1999-01-01&apos;), (2, 3, &apos;2000-01-01&apos;),</span><br><span class="line">    -&gt; (2, 4, &apos;2001-01-01&apos;), (2, 5, &apos;2002-01-01&apos;),</span><br><span class="line">    -&gt; (3, 1, &apos;1998-01-01&apos;), (3, 2, &apos;1999-01-01&apos;),</span><br><span class="line">    -&gt; (3, 3, &apos;2000-01-01&apos;), (3, 4, &apos;2001-01-01&apos;),</span><br><span class="line">    -&gt; (3, 5, &apos;2002-01-01&apos;), (4, 1, &apos;1998-01-01&apos;),</span><br><span class="line">    -&gt; (4, 2, &apos;1999-01-01&apos;), (4, 3, &apos;2000-01-01&apos;),</span><br><span class="line">    -&gt; (4, 4, &apos;2001-01-01&apos;), (4, 5, &apos;2002-01-01&apos;),</span><br><span class="line">    -&gt; (5, 1, &apos;1998-01-01&apos;), (5, 2, &apos;1999-01-01&apos;),</span><br><span class="line">    -&gt; (5, 3, &apos;2000-01-01&apos;), (5, 4, &apos;2001-01-01&apos;),</span><br><span class="line">    -&gt; (5, 5, &apos;2002-01-01&apos;);</span><br><span class="line">Query OK, 25 rows affected (0.00 sec)</span><br><span class="line">Records: 25  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"># 关闭 index-extension</span><br><span class="line">mysql&gt; SET optimizer_switch = &apos;use_index_extensions=off&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = &apos;2000-01-01&apos;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: t1</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: PRIMARY,k_d</span><br><span class="line">          key: k_d</span><br><span class="line">      key_len: 4    # !!!</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 5</span><br><span class="line">        Extra: Using where; Using index</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"> </span><br><span class="line"># 开启 index-extension</span><br><span class="line">mysql&gt; SET optimizer_switch = &apos;use_index_extensions=on&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = &apos;2000-01-01&apos;\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: t1</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: PRIMARY,k_d</span><br><span class="line">          key: k_d</span><br><span class="line">      key_len: 8    # !!!</span><br><span class="line">          ref: const,const</span><br><span class="line">         rows: 1</span><br><span class="line">        Extra: Using index</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>从上例可以看到，当 index-extension 关闭时，key_len 为 4 个字节；开启时，key_len 就变为 8 个字节，说明此时辅助索引扩展了主键索引，这可以优化查询效果。</p>
<h3 id="数据结构-1"><a href="#数据结构-1" class="headerlink" title="数据结构"></a><strong>数据结构</strong></h3><p>InnoDB 辅助索引的叶子节点中存储的不是“行指针”，而是主键值，并以此作为指向行的“指针”。如下图所示：<br><img src="/images/database/mysql/index/secondary-index-data-structure.png" alt>图片来源：《高性能 MySQL（第 3 版）》  </p>
<p>下图是聚集索引和辅助索引的区别：<br><img src="/images/database/mysql/index/clustered-secondary-index-data-structure-diff.png" alt>图片来源：《高性能 MySQL（第 3 版）》  </p>
<h2 id="前缀索引及索引选择性"><a href="#前缀索引及索引选择性" class="headerlink" title="前缀索引及索引选择性"></a><strong>前缀索引及索引选择性</strong></h2><h3 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a><strong>前缀索引</strong></h3><p>前缀索引指的是我们只索引某列开始的部分字符，这样可以大大节约索引空间，从而提高索引效率。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t1 (</span><br><span class="line">    -&gt; id int unsigned auto_increment,</span><br><span class="line">    -&gt; name varchar(20),</span><br><span class="line">    -&gt; phone varchar(20),</span><br><span class="line">    -&gt; email varchar(20),</span><br><span class="line">    -&gt; primary key (id),</span><br><span class="line">    -&gt; key i_name (name(2))</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; insert into t1 (name, phone, email) values </span><br><span class="line">    -&gt; (&apos;xhf&apos;, &apos;13736474664&apos;, &apos;xhf@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;xhf&apos;, &apos;13423474664&apos;, &apos;xhf1@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;xhf&apos;, &apos;13364474664&apos;, &apos;xhf2@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;zsw&apos;, &apos;13336474664&apos;, &apos;zsw@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;ehs&apos;, &apos;13336472436&apos;, &apos;ehs@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;ehw&apos;, &apos;13336472436&apos;, &apos;ehw@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;whw&apos;, &apos;13373626442&apos;, &apos;whw@aa.com&apos;),</span><br><span class="line">    -&gt; (&apos;wje&apos;, &apos;13333736264&apos;, &apos;wje@aa.com&apos;);</span><br><span class="line">Query OK, 8 rows affected (0.00 sec)</span><br><span class="line">Records: 8  Duplicates: 0  Warnings: 0</span><br><span class="line"> </span><br><span class="line">mysql&gt; show index from t1\G;</span><br><span class="line">...... </span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">        Table: t1</span><br><span class="line">   Non_unique: 1</span><br><span class="line">     Key_name: i_name</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: name</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 8</span><br><span class="line">     Sub_part: 2</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null: YES</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment: </span><br><span class="line">Index_comment: </span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>其中，Sub_part 字段表示列 name 的前 2 个字符被索引。</p>
<h3 id="索引选择性"><a href="#索引选择性" class="headerlink" title="索引选择性"></a><strong>索引选择性</strong></h3><p>根据《高性能 MySQL（第 3 版）》定义，索引选择性是是指：</p>
<blockquote>
<p>不重复的索引值（也称为基数，cardinality）和数据表的记录总数（#T）的比值，范围从 1/#T 到 1 之间。索引的选择性越高则查询效率越高，因为选择性高可以让 MySQL 在查找时过滤掉更多的行。唯一索引的选择性是 1，这是最好的索引选择性，性能也是最好的。</p>
</blockquote>
<p>基数 Cardinality 可以通过 show index from table 来获得，如上一小节所示。不过，需要特别注意的是，<code>在 InnoDB 引擎，Cardinality 是一个预估值，并不是精确的。</code></p>
<p>另外，我们可以通过如下方法来计算索引选择性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(distinct name)/count(*) from t1;</span><br><span class="line">+-------------------------------+</span><br><span class="line">| count(distinct name)/count(*) |</span><br><span class="line">+-------------------------------+</span><br><span class="line">|                        0.7500 |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>而对于前缀索引，我们可以通过如下方法来计算最适合前缀长度：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(distinct left(name, 1))/count(*) as sel1,</span><br><span class="line">    -&gt; count(distinct left(name, 2))/count(*) as sel2,</span><br><span class="line">    -&gt; count(distinct left(name, 3))/count(*) as sel3</span><br><span class="line">    -&gt; from t1;</span><br><span class="line">+--------+--------+--------+</span><br><span class="line">| sel1   | sel2   | sel3   |</span><br><span class="line">+--------+--------+--------+</span><br><span class="line">| 0.5000 | 0.6250 | 0.7500 |</span><br><span class="line">+--------+--------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>当然，即使某前缀长度的选择性最高，但也要考虑其可能带来的问题，如长度过长导致索引存储空间大。</p>
<h1 id="其他类型索引"><a href="#其他类型索引" class="headerlink" title="其他类型索引"></a><strong>其他类型索引</strong></h1><h2 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a><strong>联合索引</strong></h2><p>联合索引在<a href="https://dev.mysql.com/doc/refman/5.6/en/multiple-column-indexes.html" target="_blank" rel="noopener">官方文档</a>中称为多列索引（Multiple Column Indexes），也即其是由表中多列组成的索引。按照之前定义，联合索引也属于辅助索引。</p>
<p>既然已经有单列索引，但为什么还需要多列索引呢？Segmentfault 上的一个针对问题 <a href="https://segmentfault.com/q/1010000000342176" target="_blank" rel="noopener">MySQL 里创建‘联合索引’的意义？</a>的回答说的挺易懂，特摘录如下：</p>
<blockquote>
<p>索引列越多，通过索引筛选出的数据越少。有 1000W 条数据的表，有如下 sql:select * from table where a = 1 and b =2 and c = 3，假设假设每个条件可以筛选出 10% 的数据，如果只有单值索引，那么通过该索引能筛选出 1000W*10%=100w 条数据，然后再回表从 100w 条数据中找到符合 b=2 and c= 3 的数据，然后再排序，再分页；如果是复合索引，通过索引筛选出 1000w *10% *10% *10%=1w，然后再排序、分页，哪个更高效，一眼便知。</p>
</blockquote>
<p>除了能够<code>加快查询速度</code>，<code>联合索引的另一个好处是已经对第二个键值进行了排序</code>。当我们对查询结果进行排序的时候就可以充分利用这个特性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个表</span><br><span class="line">mysql&gt; create table t1 (</span><br><span class="line">    -&gt; id int unsigned auto_increment,</span><br><span class="line">    -&gt; name varchar(20),</span><br><span class="line">    -&gt; phone varchar(20),</span><br><span class="line">    -&gt; email varchar(20),</span><br><span class="line">    -&gt; primary key (id),</span><br><span class="line">    -&gt; key i_name_phone (name, phone)</span><br><span class="line">    -&gt; );</span><br><span class="line"> </span><br><span class="line"># 测试数据</span><br><span class="line">mysql&gt; select * from t1;</span><br><span class="line">+----+------+-------------+-------------+</span><br><span class="line">| id | name | phone       | email       |</span><br><span class="line">+----+------+-------------+-------------+</span><br><span class="line">|  1 | xhf  | 13736474664 | xhf@aa.com  |</span><br><span class="line">|  2 | zsw  | 13336474664 | zsw@aa.com  |</span><br><span class="line">|  3 | ehs  | 13336472436 | ehs@aa.com  |</span><br><span class="line">|  4 | whw  | 13373626442 | whw@aa.com  |</span><br><span class="line">|  5 | wje  | 13333736264 | wje@aa.com  |</span><br><span class="line">|  6 | xhf  | 13423474664 | xhf1@aa.com |</span><br><span class="line">|  7 | xhf  | 13364474664 | xhf2@aa.com |</span><br><span class="line">|  8 | xhf  | 13423474664 | xhf3@aa.com |</span><br><span class="line">+----+------+-------------+-------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line"># 测试</span><br><span class="line">mysql&gt; explain select name, phone from t1 where name=&apos;xhf&apos; order by phone;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+--------------------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref   | rows | Extra                    |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+--------------------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 23      | const |    4 | Using where; Using index |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+--------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select name, phone from t1 where name=&apos;xhf&apos; order by id;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+------------------------------------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref   | rows | Extra                                    |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+------------------------------------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 23      | const |    4 | Using where; Using index; Using filesort |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select name, phone from t1 where name=&apos;xhf&apos; order by email;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                       |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ALL  | i_name_phone  | NULL | NULL    | NULL |    8 | Using where; Using filesort |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------+</span><br></pre></td></tr></table></figure></p>
<p>从以上结果可以看出，当我们按 phone 对查询结果进行排序时，我们并不需要用到 filesort，也即，这时 MySQL 服务器层并不需要对存储引擎返回的结果进行排序；而另外两种情况，都需要在服务器层进行排序。</p>
<h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a><strong>覆盖索引</strong></h2><p>对于覆盖索引（Covering Index），58 沈剑的一篇微信文章<a href="http://mp.weixin.qq.com/s/4W4iVOZHdMglk0F_Ikao7A" target="_blank" rel="noopener">一分钟了解索引技巧</a>写的通俗易懂：</p>
<blockquote>
<p><code>被查询的列，数据能从索引中取得</code>，而不用通过行定位符 row-locator 再到 row 上获取，即“被查询列要被所建的索引覆盖”，这能够加速查询速度。</p>
</blockquote>
<blockquote>
<p>举例，登录业务需求：select uid, login_time from t_user where login_name=? and passwd=?</p>
</blockquote>
<blockquote>
<p>可以建立(login_name, passwd, <code>login_time</code>)的联合索引，由于 login_time 已经建立在索引中了，被查询的 uid 和 login_time 就不用去 row 上获取数据了，从而加速查询。</p>
</blockquote>
<p>对于该类型索引，更加严谨的说法来自《MySQL 技术内幕：InnoDB 存储引擎（第 2 版）》一书：</p>
<blockquote>
<p>从辅助索引就可以得到查询的记录，而不需要查询聚集索引中的记录。使用覆盖索引的一个好处是辅助索引不包含整行记录的所有信息，故其大小要远小于聚集索引。 </p>
</blockquote>
<p>可以看出，覆盖索引也是联合索引的一种。</p>
<p>沿用上边例子，我们展示下覆盖索引用法及特性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 为了检验联合索引效果，我们先关闭 Index Condition Pushdown (ICP) 优化</span><br><span class="line">mysql&gt; set optimizer_switch = &apos;index_condition_pushdown=off&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select id, name, phone from t1 where name=&apos;xhf&apos;;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+--------------------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref   | rows | Extra                    |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+--------------------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 23      | const |    4 | Using where; Using index |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------+------+--------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select email from t1 where name=&apos;xhf&apos; and phone=&apos;13736474664&apos;;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref         | rows | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 46      | const,const |    1 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select * from t1 where name=&apos;xhf&apos; and phone=&apos;13736474664&apos;;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref         | rows | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 46      | const,const |    1 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>因为 id、name 及 phone 默认组成一个联合索引，所以在当前 where 条件下他们的数据可以直接从该索引获得；而 email 及 * 并不能从该索引直接获取，而需要在 MySQL 服务器层进行过滤。</p>
<h1 id="优化技术"><a href="#优化技术" class="headerlink" title="优化技术"></a><strong>优化技术</strong></h1><h2 id="Index-Condition-Pushdown-ICP"><a href="#Index-Condition-Pushdown-ICP" class="headerlink" title="Index Condition Pushdown (ICP)"></a><strong>Index Condition Pushdown (ICP)</strong></h2><p>延用我们在“联合索引”的例子，关闭和开启 Index Condition Pushdown (ICP) 时查询可能会得到不同的结果，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set optimizer_switch = &apos;index_condition_pushdown=off&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select email from t1 where name=&apos;xhf&apos; and phone=&apos;13736474664&apos;;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref         | rows | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 46      | const,const |    1 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; set optimizer_switch = &apos;index_condition_pushdown=on&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; explain select email from t1 where name=&apos;xhf&apos; and phone=&apos;13736474664&apos;;</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-----------------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key          | key_len | ref         | rows | Extra                 |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-----------------------+</span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | i_name_phone  | i_name_phone | 46      | const,const |    1 | Using index condition |</span><br><span class="line">+----+-------------+-------+------+---------------+--------------+---------+-------------+------+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>也即后一个查询使用了 ICP 技术。这样能够提高效率，因为<code>该技术使得 where 部分的过滤操作放在了存储引擎层而不是服务器层。</code></p>
<h2 id="Index-Merge"><a href="#Index-Merge" class="headerlink" title="Index Merge"></a><strong>Index Merge</strong></h2><p><em>有待添加</em></p>
<h2 id="Multi-Range-Read"><a href="#Multi-Range-Read" class="headerlink" title="Multi-Range Read"></a><strong>Multi-Range Read</strong></h2><p><em>有待添加</em></p>
<h1 id="索引使用规范"><a href="#索引使用规范" class="headerlink" title="索引使用规范"></a><strong>索引使用规范</strong></h1><ul>
<li>全值匹配</li>
<li>匹配最左前缀</li>
<li>匹配列前缀</li>
<li>匹配范围值</li>
<li>精确匹配某一列并范围匹配另外一列</li>
<li>只访问索引的查询（覆盖索引）</li>
</ul>
<h1 id="表设计规范"><a href="#表设计规范" class="headerlink" title="表设计规范"></a>表设计规范</h1><ul>
<li>使用递增主键，最好不要是那种没有规律类型，如 UUID</li>
<li>列默认值不设为 null，设定为 0 或 false</li>
<li>外键自动添加索引（InnoDB 默认行为）</li>
</ul>
<h1 id="附：Explain-工具"><a href="#附：Explain-工具" class="headerlink" title="附：Explain 工具"></a><strong>附：Explain 工具</strong></h1><p>我们在前文多次用到了 Explain 来查看 MySQL 对某语句<strong>可能</strong>的执行计划，但并没有做过多解释。下边就让我们来看看常用的一些字段的以及以及它们可能会有的值。</p>
<p><strong>注：</strong>这里主要总结或摘录自《高性能 MySQL（第 3 版）》附录，部分参考自：</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.5/en/explain-output.html" target="_blank" rel="noopener">官文文档</a></li>
<li><a href="http://imysql.com/2015/11/04/mysql-faq-some-important-in-explain.shtml" target="_blank" rel="noopener">EXPLAIN 执行计划中要重点关注哪些要素</a></li>
</ul>
<h2 id="字段详细意义"><a href="#字段详细意义" class="headerlink" title="字段详细意义"></a><strong>字段详细意义</strong></h2><h3 id="id-列"><a href="#id-列" class="headerlink" title="id 列"></a><strong>id 列</strong></h3><p>这一列总是包含一个编号，表示 select 所属的行。如果在语句当中没有子查询或联合，那么只会有唯一的 select，于是每一行在这个列中都将显示一个 1.否则，内层的 select 语句一般会顺序编号，对应于其在原始语句中的位置。</p>
<h3 id="select-type-列"><a href="#select-type-列" class="headerlink" title="select_type 列"></a><strong>select_type 列</strong></h3><p>这一列显示了对英航是简单还是复杂 select（如果是后者，那么是三种复杂类型中的哪一种）。SIMPLE 值意味着查询不包括子查询和 UNION。如果查询有任何复杂的子部分，则最外层部分标记为 PRIMARY，其他部分标记为 SUBQUERY、DERIVED、UNION 或 UNION RESULT。</p>
<h3 id="table-列"><a href="#table-列" class="headerlink" title="table 列"></a><strong>table 列</strong></h3><p>这一列显示了对应行正在访问哪个表。在通常情况下，它相当明了：它就是那个表，或是该表的别名（如果 SQL 中定义了别名）。</p>
<h3 id="type-列"><a href="#type-列" class="headerlink" title="type 列"></a><strong>type 列</strong></h3><ul>
<li><p><strong>ALL</strong><br>全表扫描，通常意味着 MySQL 必须扫描整张表，从头到尾，去找到需要的行。（这里也有个例外，例如在查询里使用了 LIMIT，或者在 Extra 列中显示“Using distinct/not exists”。）</p>
</li>
<li><p><strong>index</strong><br>跟全表扫描一样，只是 MySQL 扫描表时按索引次序进行而不是行。它的主要优点是避免了排序；最大的缺点是要承担按索引次序读取整个表的开销。这通常意味着若是按随机次序访问行，开销将会非常大。</p>
</li>
</ul>
<p>如果在 Extra 列中看到“Using index”，说明 MySQL 正在使用覆盖索引，它只扫描索引的数据，而不是按索引次序的每一行。它比按索引次序全表扫描的开销要少很多。</p>
<p><strong>注意</strong>：<code>type 列里的 index 跟 Extra 列的 Using index 完全不是同一个意思。</code></p>
<ul>
<li><strong>range</strong></li>
</ul>
<p>范围扫描就是一个有限制的索引扫描，它开始于索引里的某一点，返回匹配这个值域的行。这比全索引扫描好一些，因为它用不着遍历全部索引。显而易见的范围扫描是带有 BETWEEN 或在 WHERE 子句里带有 &gt; 的查询。</p>
<p>当 MySQL 使用索引去查找一系列值时，例如 IN() 和 OR 列表，也会显示为范围扫描。然而，这两者其实是相当不同的访问类型，在性能上有重要的差异。更多信息可查看《高性能 MySQL（第 3 版）》第 5 章“什么事范围条件”。</p>
<p>此类扫描的开销跟索引类型相当。</p>
<ul>
<li><p><strong>index_subquery</strong><br>子查询中可以用到索引。</p>
</li>
<li><p><strong>unique_subquery</strong><br>子查询中可以用到唯一索引，效率比 index_subquery 更高些。</p>
</li>
<li><p><strong>index_merge</strong><br>可以利用index merge特性用到多个索引，提高查询效率。</p>
</li>
<li><p><strong>fulltext</strong><br>全文检索。</p>
</li>
<li><p><strong>ref</strong><br>这是一种索引访问（有时也叫索引查找），它返回所有匹配某个单个值的行。然而，它可能会找到多个符合条件的行，因此，它是查找和扫描的混合体。此类索引访问只有当使用非唯一性索引或者唯一性索引的非唯一性前缀时才会发生。把它叫做 ref 是因为索引要跟某个参考值相比较。这个参考值或者是一个常数，或者是来自多表查询前一个表里的结果值。</p>
</li>
</ul>
<p>ref_or_null 是 ref 之上的一个变体，它意味着 MySQL 必须在初次查找的结果里进行第二次查找以找出 NULL 条目。</p>
<ul>
<li><p><strong>eq_ref</strong><br>使用这种索引查找，MySQL 知道最多只返回一条符合条件的记录。这种访问方法可以在 MySQL 使用主键或者唯一性索引查找时看到，它会将它们与某个参考值作比较。MySQL 对于这类访问类型的优化做的非常好，因为它知道无需估计匹配行的范围或在找到匹配行后再继续查找。</p>
</li>
<li><p><strong>const, system</strong><br>当 MySQL 能对查询的某部分进行优化并将其转换成一个常量时，它就会使用这些访问类型。举例来说，如果你通过将某一行的主键放入 WHERE 子句里的方式来选取此行的主键，MySQL 就能把这个查询转换为一个常量。然后就可以高效地将表从联接执行中移除。</p>
</li>
<li><p><strong>NULL</strong><br>这种访问方式意味着 MySQL 能在优化阶段分解查询语句，在执行阶段甚至用不着再访问表或者索引。例如，从一个索引列里选取最小值可以通过单独查找索引来完成，不需要在执行时访问表。</p>
</li>
</ul>
<h3 id="possible-keys-列"><a href="#possible-keys-列" class="headerlink" title="possible_keys 列"></a><strong>possible_keys 列</strong></h3><p>这一列显示了查询可以使用哪些索引，这是基于查询访问的列和使用的比较操作符来判断的。这个列是在优化过程的早期创建的，因为有些罗列出来的索引可能对于后续优化过程是没有的。</p>
<p><strong>注意</strong>：这里的 key 表示索引。</p>
<h3 id="key-列"><a href="#key-列" class="headerlink" title="key 列"></a><strong>key 列</strong></h3><p>这一列显示了 MySQL 决定采用哪个索引来优化对该表的访问。如果该索引没有出现在 possible_keys 列中，那么 MySQL 选用它是出于另外的原因——例如，它可能选择了一个覆盖索引，哪怕没有 WHERE 语句。</p>
<p>换句话说，possible_keys 解释了哪一个索引能有助于高效地行查找，而 key 显示的是优化采用哪一个索引可以最小化查询成本。</p>
<h3 id="key-len-列"><a href="#key-len-列" class="headerlink" title="key_len 列"></a><strong>key_len 列</strong></h3><p>该列显示了 MySQL 在索引里使用的字节数。如果 MySQL 正在使用的只是索引里的某些列，那么就可以用这个值来算出具体是哪些列。</p>
<p>关于 key_len 详细计算可参考博文<a href="http://imysql.com/2015/10/20/mysql-faq-key-len-in-explain.shtml" target="_blank" rel="noopener">解读 EXPLAIN 执行计划中的 key_len</a>。</p>
<h3 id="ref-列"><a href="#ref-列" class="headerlink" title="ref 列"></a><strong>ref 列</strong></h3><p>这一列显示了之前的表在 key 列记录的索引中查找值所用的列或常量。</p>
<h3 id="rows-列"><a href="#rows-列" class="headerlink" title="rows 列"></a><strong>rows 列</strong></h3><p>这一列是 MySQL 估计为了找到所需的行而要读取的行数。这个数字是内嵌循环关联计划里的循环数目。也就是说它不是 MySQL 认为它最终要从表里读取出来的行数，而是 MySQL 为了找到符合查询的每一点上标准的那些行而必须读取的行的平均数。（这个标准包括 SQL 里给定的条件，以及来自联接次序上前一个表的当前列。）</p>
<p>根据表的统计信息和索引的选用情况，这个估算可能很不精确。</p>
<h3 id="filtered-列"><a href="#filtered-列" class="headerlink" title="filtered 列"></a><strong>filtered 列</strong></h3><p>这一列是在 MySQL 5.1 里新加进去的，在使用 EXPLAIN EXTENDED 时出现。它显示的是针对表里符合某个条件（WHERE 子句或联接条件）的记录数的百分比所做的一个悲观估算。如果把 rows 列和这个百分比相乘，就能看到 MySQL 估算它将和查询计划里前一个表关联的行数。</p>
<h3 id="Extra-列"><a href="#Extra-列" class="headerlink" title="Extra 列"></a><strong>Extra 列</strong></h3><p>这一列包含的是不适合在其他列显示的额外信息。MySQL 用户手册里记录了大多数可以在这里出现的值。其中重要的值如下：</p>
<ul>
<li><p><strong>Using index</strong><br>表示使用覆盖索引。注意和 type 列的 index 值区分开来。</p>
</li>
<li><p><strong>Using where（<code>服务器层面</code>）</strong><br>意味着 MySQL 服务器将在存储引擎检索行后（而不是在存储引擎），再进行过滤。</p>
</li>
<li><p><strong>Using index condition（<code>存储引擎层面</code>）</strong><br>意味着使用 Index Condition Pushdown (ICP) 技术，使得 where 部分的过滤操作放在了存储引擎层而不是服务器层。</p>
</li>
<li><p><strong>Select tables optimized away</strong><br>使用某些聚合函数来访问存在索引的某个字段时，优化器会通过索引直接一次定位到所需要的数据行完成整个查询，例如 MIN()/MAX()，这种也是比较好的结果之一。</p>
</li>
<li><p><strong>Using temporary</strong><br>意味着 MySQL 在对查询结果排序时会使用一个临时表。</p>
</li>
<li><p><strong>Using filesort</strong><br>意味着 MySQL 会对结果使用一个外部索引排序，而不是按索引次序从表里读取行。MySQL 有两种文件排序算法。Explain 不会告诉我们 MySQL 将使用哪一种文件排序，也不会告诉我们排序会在内存里还是磁盘上完成。</p>
</li>
<li><p><strong>Range checked for each record (index map:N)</strong><br>意味着没有好用的索引，新的索引将在联接的每一行上重新估算。N 是 possible_keys 列中索引的位图，并且是冗余的。</p>
</li>
<li><p><strong>Impossible WHERE</strong><br>对Where子句判断的结果总是false而不能选择任何数据，例如 where 1=0，无需过多关注。</p>
</li>
</ul>
<h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a><strong>限制</strong></h2><p>Explain 得到的结果只是个近似结果。有时候它是一个很好的近似，但在其他时候，可能与真相相差甚远。以下是一些相关限制：</p>
<ul>
<li>Explain 根本不会告诉你触发器、存储过程或 UDF 会如何影响查询</li>
<li>它并不支持存储过程，尽管可以手动抽取查询并单独地对其进行 Explain 操作</li>
<li>它并不会告诉你 MySQL 在查询执行中所做的特定优化</li>
<li>它并不会显示关于查询执行计划的所有信息</li>
<li>它并不区分具有相同名字的食物。例如，它对内存排序和临时文件排序都适用“Using filesort”，并且对于磁盘上和内存中的临时表都显示“Using  temporary”。</li>
<li>可能会误导。例如，它会对一个有着很小 LIMIT 的查询显示全索引扫描。（MySQL 5.1 的 Explain 关于检查的行数会显示更精确的信息，但早期版本并不考虑 LIMIT）</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/08/12/cloud-vm-lifecycle/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          【译】 虚拟机生命周期
        
      </div>
    </a>
  
  
    <a href="/2017/07/04/db-migration/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">数据库版本管理</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>







      <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>

<script>
var gitalk = new Gitalk({
  clientID: '64c19d7f57bebbb343c4',
  clientSecret: '287daeba39e73fdde92f24540c9f3c0fd5238512',
  repo: 'BlogComments',
  owner: 'xiemax100',
  admin: ['xiemax100'],
  id: md5(window.location.pathname),
  distractionFreeMode: true
})

gitalk.render('gitalk-container')
</script>






    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#索引"><span class="toc-number">1.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#索引-1"><span class="toc-number">1.1.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B-树简介"><span class="toc-number">1.2.</span> <span class="toc-text">B+ 树简介</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#聚集索引和辅助索引"><span class="toc-number">2.</span> <span class="toc-text">聚集索引和辅助索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#聚集索引"><span class="toc-number">2.1.</span> <span class="toc-text">聚集索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">2.1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#磁盘存储"><span class="toc-number">2.1.2.</span> <span class="toc-text">磁盘存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据结构"><span class="toc-number">2.1.3.</span> <span class="toc-text">数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#辅助索引"><span class="toc-number">2.2.</span> <span class="toc-text">辅助索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据结构-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前缀索引及索引选择性"><span class="toc-number">2.3.</span> <span class="toc-text">前缀索引及索引选择性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前缀索引"><span class="toc-number">2.3.1.</span> <span class="toc-text">前缀索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引选择性"><span class="toc-number">2.3.2.</span> <span class="toc-text">索引选择性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#其他类型索引"><span class="toc-number">3.</span> <span class="toc-text">其他类型索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#联合索引"><span class="toc-number">3.1.</span> <span class="toc-text">联合索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#覆盖索引"><span class="toc-number">3.2.</span> <span class="toc-text">覆盖索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#优化技术"><span class="toc-number">4.</span> <span class="toc-text">优化技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-Condition-Pushdown-ICP"><span class="toc-number">4.1.</span> <span class="toc-text">Index Condition Pushdown (ICP)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-Merge"><span class="toc-number">4.2.</span> <span class="toc-text">Index Merge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multi-Range-Read"><span class="toc-number">4.3.</span> <span class="toc-text">Multi-Range Read</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#索引使用规范"><span class="toc-number">5.</span> <span class="toc-text">索引使用规范</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#表设计规范"><span class="toc-number">6.</span> <span class="toc-text">表设计规范</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附：Explain-工具"><span class="toc-number">7.</span> <span class="toc-text">附：Explain 工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#字段详细意义"><span class="toc-number">7.1.</span> <span class="toc-text">字段详细意义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#id-列"><span class="toc-number">7.1.1.</span> <span class="toc-text">id 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-type-列"><span class="toc-number">7.1.2.</span> <span class="toc-text">select_type 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#table-列"><span class="toc-number">7.1.3.</span> <span class="toc-text">table 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#type-列"><span class="toc-number">7.1.4.</span> <span class="toc-text">type 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#possible-keys-列"><span class="toc-number">7.1.5.</span> <span class="toc-text">possible_keys 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key-列"><span class="toc-number">7.1.6.</span> <span class="toc-text">key 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key-len-列"><span class="toc-number">7.1.7.</span> <span class="toc-text">key_len 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-列"><span class="toc-number">7.1.8.</span> <span class="toc-text">ref 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rows-列"><span class="toc-number">7.1.9.</span> <span class="toc-text">rows 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filtered-列"><span class="toc-number">7.1.10.</span> <span class="toc-text">filtered 列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extra-列"><span class="toc-number">7.1.11.</span> <span class="toc-text">Extra 列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限制"><span class="toc-number">7.2.</span> <span class="toc-text">限制</span></a></li></ol></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var toc_button = document.getElementById("tocButton");
    var toc_div = document.getElementById("toc");
    toc_button.onclick=function() {
        if (toc_div.style.display == "none") {
            toc_div.style.display = "block";
            toc_button.value = "隐藏目录";
            document.getElementById("switch-btn").style.display = "none";
            document.getElementById("switch-area").style.display = "none";
        }
        else {
            toc_div.style.display = "none";
            toc_button.value = "显示目录";
            document.getElementById("switch-btn").style.display = "block";
            document.getElementById("switch-area").style.display = "block";
        }
    }

    if ($(".toc").length < 1) {
        $("#toc").css("display","none");
        $("#tocButton").css("display","none");
        $(".switch-btn").css("display","block");
        $(".switch-area").css("display","block");
    }
</script>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 Max
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>