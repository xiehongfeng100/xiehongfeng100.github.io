<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Routes | Max&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="按照官方介绍，Routes 是 Rails routes 的 Python 版，用于将不同的 URL 映射到对应的应用上，这对于开发 Restful URL 非常便利：  Routes is a Python re-implementation of the Rails routes system for mapping URLs to application actions, and conve">
<meta name="keywords" content="Python,WSGI,routes">
<meta property="og:type" content="article">
<meta property="og:title" content="Routes">
<meta property="og:url" content="http://xiehongfeng100.github.io/2017/05/20/python-web-routes/index.html">
<meta property="og:site_name" content="Max&#39;s Blog">
<meta property="og:description" content="按照官方介绍，Routes 是 Rails routes 的 Python 版，用于将不同的 URL 映射到对应的应用上，这对于开发 Restful URL 非常便利：  Routes is a Python re-implementation of the Rails routes system for mapping URLs to application actions, and conve">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-05-01T05:01:43.953Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Routes">
<meta name="twitter:description" content="按照官方介绍，Routes 是 Rails routes 的 Python 版，用于将不同的 URL 映射到对应的应用上，这对于开发 Restful URL 非常便利：  Routes is a Python re-implementation of the Rails routes system for mapping URLs to application actions, and conve">
  
    <link rel="alternative" href="/atom.xml" title="Max&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/author.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Max</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Stay hungry, stay foolish.</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/categories/读书">读书</a></li>
				        
							<li><a href="/tags/翻译">翻译</a></li>
				        
							<li><a href="/categories/网络">网络</a></li>
				        
							<li><a href="/categories/并发">并发</a></li>
				        
							<li><a href="/categories/安全">安全</a></li>
				        
							<li><a href="/categories/运维">运维</a></li>
				        
							<li><a href="/categories/数据库">数据库</a></li>
				        
							<li><a href="/categories/云计算">云计算</a></li>
				        
							<li><a href="/categories/编程语言">编程语言</a></li>
				        
							<li><a href="/categories/操作系统">操作系统</a></li>
				        
							<li><a href="/categories/机器学习">机器学习</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/xiehongfeng100" title="github">github</a>
					        
								<a class="linkedin" target="_blank" href="http://cn.linkedin.com/in/xiehongfeng100" title="linkedin">linkedin</a>
					        
								<a class="mail" target="_blank" href="mailto:xiehongfeng100@hotmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/tmp/" style="font-size: 10px;">/tmp</a> <a href="/tags/AT-T/" style="font-size: 10px;">AT&T</a> <a href="/tags/Affin/" style="font-size: 10px;">Affin</a> <a href="/tags/Alembic/" style="font-size: 10px;">Alembic</a> <a href="/tags/B-树/" style="font-size: 10px;">B+ 树</a> <a href="/tags/BIOS/" style="font-size: 10px;">BIOS</a> <a href="/tags/Buffer-Pool/" style="font-size: 10px;">Buffer Pool</a> <a href="/tags/C-C/" style="font-size: 16.67px;">C/C++</a> <a href="/tags/CA/" style="font-size: 10px;">CA</a> <a href="/tags/CBOW/" style="font-size: 10px;">CBOW</a> <a href="/tags/CNN/" style="font-size: 10.83px;">CNN</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/Decorator/" style="font-size: 10px;">Decorator</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Dnsmasq/" style="font-size: 10px;">Dnsmasq</a> <a href="/tags/ELF/" style="font-size: 10px;">ELF</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Elasticsearch/" style="font-size: 11.67px;">Elasticsearch</a> <a href="/tags/GCC/" style="font-size: 10px;">GCC</a> <a href="/tags/HBR/" style="font-size: 10px;">HBR</a> <a href="/tags/IO-Multiplexing/" style="font-size: 11.67px;">IO Multiplexing</a> <a href="/tags/IPTables/" style="font-size: 10px;">IPTables</a> <a href="/tags/Immunity-Debugger/" style="font-size: 10px;">Immunity Debugger</a> <a href="/tags/InnoDB/" style="font-size: 15.83px;">InnoDB</a> <a href="/tags/KD-Tree/" style="font-size: 10.83px;">KD-Tree</a> <a href="/tags/KNN/" style="font-size: 10px;">KNN</a> <a href="/tags/KVM/" style="font-size: 10px;">KVM</a> <a href="/tags/Kali-Linux/" style="font-size: 10px;">Kali Linux</a> <a href="/tags/Keras/" style="font-size: 10px;">Keras</a> <a href="/tags/Keystone/" style="font-size: 13.33px;">Keystone</a> <a href="/tags/Kibana/" style="font-size: 10px;">Kibana</a> <a href="/tags/Lemmatization/" style="font-size: 10px;">Lemmatization</a> <a href="/tags/Libvirt/" style="font-size: 10.83px;">Libvirt</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/LinuxBridge/" style="font-size: 11.67px;">LinuxBridge</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/Logstash/" style="font-size: 10px;">Logstash</a> <a href="/tags/MRO/" style="font-size: 10px;">MRO</a> <a href="/tags/Metasploit-Framwork/" style="font-size: 10px;">Metasploit Framwork</a> <a href="/tags/MySQL/" style="font-size: 16.67px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Namespace/" style="font-size: 10px;">Namespace</a> <a href="/tags/Neo4J/" style="font-size: 10.83px;">Neo4J</a> <a href="/tags/Neutron/" style="font-size: 13.33px;">Neutron</a> <a href="/tags/Nova/" style="font-size: 14.17px;">Nova</a> <a href="/tags/OpenStack/" style="font-size: 17.5px;">OpenStack</a> <a href="/tags/OpenVSwitch/" style="font-size: 10px;">OpenVSwitch</a> <a href="/tags/PKI/" style="font-size: 10.83px;">PKI</a> <a href="/tags/PasteDeploy/" style="font-size: 10.83px;">PasteDeploy</a> <a href="/tags/Policy/" style="font-size: 10px;">Policy</a> <a href="/tags/Python/" style="font-size: 18.33px;">Python</a> <a href="/tags/QEMU/" style="font-size: 10px;">QEMU</a> <a href="/tags/RBAC/" style="font-size: 10px;">RBAC</a> <a href="/tags/RPC/" style="font-size: 10px;">RPC</a> <a href="/tags/Redo-Log/" style="font-size: 10px;">Redo Log</a> <a href="/tags/SQLAlchemy-Migrate/" style="font-size: 10px;">SQLAlchemy-Migrate</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/Sigmoid/" style="font-size: 10px;">Sigmoid</a> <a href="/tags/Skip-Gram/" style="font-size: 10px;">Skip-Gram</a> <a href="/tags/Socket/" style="font-size: 10px;">Socket</a> <a href="/tags/Stop-Words/" style="font-size: 10px;">Stop Words</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Tap/" style="font-size: 10.83px;">Tap</a> <a href="/tags/Token/" style="font-size: 11.67px;">Token</a> <a href="/tags/Tokenization/" style="font-size: 10px;">Tokenization</a> <a href="/tags/Trampolining/" style="font-size: 10px;">Trampolining</a> <a href="/tags/Tun/" style="font-size: 10.83px;">Tun</a> <a href="/tags/Tunnel/" style="font-size: 10px;">Tunnel</a> <a href="/tags/UUID/" style="font-size: 10px;">UUID</a> <a href="/tags/Undo-Log/" style="font-size: 10px;">Undo Log</a> <a href="/tags/VNC/" style="font-size: 10px;">VNC</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/Veth/" style="font-size: 11.67px;">Veth</a> <a href="/tags/VirtualBox/" style="font-size: 10px;">VirtualBox</a> <a href="/tags/Vlan/" style="font-size: 10px;">Vlan</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/WSGI/" style="font-size: 13.33px;">WSGI</a> <a href="/tags/Webob/" style="font-size: 10px;">Webob</a> <a href="/tags/Word2Vec/" style="font-size: 10.83px;">Word2Vec</a> <a href="/tags/Yelper/" style="font-size: 15px;">Yelper</a> <a href="/tags/bootsect/" style="font-size: 10px;">bootsect</a> <a href="/tags/cookiecutter/" style="font-size: 10px;">cookiecutter</a> <a href="/tags/delete/" style="font-size: 10px;">delete</a> <a href="/tags/dnsmasq/" style="font-size: 10px;">dnsmasq</a> <a href="/tags/entry-points/" style="font-size: 10px;">entry_points</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/fork/" style="font-size: 10px;">fork</a> <a href="/tags/head/" style="font-size: 10px;">head</a> <a href="/tags/inode/" style="font-size: 10px;">inode</a> <a href="/tags/malloc/" style="font-size: 10px;">malloc</a> <a href="/tags/mona/" style="font-size: 10px;">mona</a> <a href="/tags/new/" style="font-size: 10px;">new</a> <a href="/tags/property/" style="font-size: 10px;">property</a> <a href="/tags/read/" style="font-size: 10px;">read</a> <a href="/tags/routes/" style="font-size: 10px;">routes</a> <a href="/tags/select/" style="font-size: 10px;">select</a> <a href="/tags/setup/" style="font-size: 10px;">setup</a> <a href="/tags/setuptools/" style="font-size: 10px;">setuptools</a> <a href="/tags/shell/" style="font-size: 10.83px;">shell</a> <a href="/tags/stevedore/" style="font-size: 10px;">stevedore</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/tcpdump/" style="font-size: 10px;">tcpdump</a> <a href="/tags/uWSGI/" style="font-size: 10px;">uWSGI</a> <a href="/tags/update-进程/" style="font-size: 10px;">update 进程</a> <a href="/tags/write/" style="font-size: 10px;">write</a> <a href="/tags/wsgiref/" style="font-size: 10px;">wsgiref</a> <a href="/tags/yield/" style="font-size: 14.17px;">yield</a> <a href="/tags/中断/" style="font-size: 10.83px;">中断</a> <a href="/tags/事务/" style="font-size: 13.33px;">事务</a> <a href="/tags/任务调度/" style="font-size: 10px;">任务调度</a> <a href="/tags/传记/" style="font-size: 10.83px;">传记</a> <a href="/tags/信号/" style="font-size: 10px;">信号</a> <a href="/tags/信号量/" style="font-size: 10px;">信号量</a> <a href="/tags/内存对齐/" style="font-size: 10px;">内存对齐</a> <a href="/tags/内存映射-I-O/" style="font-size: 10px;">内存映射 I/O</a> <a href="/tags/内存规划/" style="font-size: 10px;">内存规划</a> <a href="/tags/内核/" style="font-size: 19.17px;">内核</a> <a href="/tags/内核栈/" style="font-size: 10px;">内核栈</a> <a href="/tags/分页/" style="font-size: 10px;">分页</a> <a href="/tags/加密/" style="font-size: 10.83px;">加密</a> <a href="/tags/加载/" style="font-size: 10.83px;">加载</a> <a href="/tags/协程/" style="font-size: 13.33px;">协程</a> <a href="/tags/可执行目标文件/" style="font-size: 10.83px;">可执行目标文件</a> <a href="/tags/可重定位目标文件/" style="font-size: 10px;">可重定位目标文件</a> <a href="/tags/同步/" style="font-size: 10px;">同步</a> <a href="/tags/商业/" style="font-size: 11.67px;">商业</a> <a href="/tags/地心坐标系/" style="font-size: 10px;">地心坐标系</a> <a href="/tags/多线程/" style="font-size: 10.83px;">多线程</a> <a href="/tags/多进程/" style="font-size: 10px;">多进程</a> <a href="/tags/字符串/" style="font-size: 10px;">字符串</a> <a href="/tags/存储器/" style="font-size: 10.83px;">存储器</a> <a href="/tags/宏/" style="font-size: 10px;">宏</a> <a href="/tags/寄存器/" style="font-size: 10px;">寄存器</a> <a href="/tags/开发环境/" style="font-size: 10px;">开发环境</a> <a href="/tags/异常/" style="font-size: 10px;">异常</a> <a href="/tags/异步/" style="font-size: 10px;">异步</a> <a href="/tags/引导块/" style="font-size: 10px;">引导块</a> <a href="/tags/引导程序/" style="font-size: 12.5px;">引导程序</a> <a href="/tags/归一化/" style="font-size: 10px;">归一化</a> <a href="/tags/微处理器/" style="font-size: 13.33px;">微处理器</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a> <a href="/tags/情感分析/" style="font-size: 10px;">情感分析</a> <a href="/tags/扩容/" style="font-size: 10px;">扩容</a> <a href="/tags/指令集/" style="font-size: 10px;">指令集</a> <a href="/tags/指针/" style="font-size: 12.5px;">指针</a> <a href="/tags/数字签名/" style="font-size: 10px;">数字签名</a> <a href="/tags/数字证书/" style="font-size: 10px;">数字证书</a> <a href="/tags/整数/" style="font-size: 10px;">整数</a> <a href="/tags/文件系统/" style="font-size: 12.5px;">文件系统</a> <a href="/tags/时钟/" style="font-size: 10px;">时钟</a> <a href="/tags/时钟中断/" style="font-size: 10px;">时钟中断</a> <a href="/tags/时间衰减函数/" style="font-size: 10px;">时间衰减函数</a> <a href="/tags/权限/" style="font-size: 10px;">权限</a> <a href="/tags/标准输入/" style="font-size: 10px;">标准输入</a> <a href="/tags/标准输出/" style="font-size: 10px;">标准输出</a> <a href="/tags/标准错误输出/" style="font-size: 10px;">标准错误输出</a> <a href="/tags/栈帧/" style="font-size: 10px;">栈帧</a> <a href="/tags/栈溢出/" style="font-size: 10px;">栈溢出</a> <a href="/tags/根设备/" style="font-size: 10px;">根设备</a> <a href="/tags/死锁/" style="font-size: 10px;">死锁</a> <a href="/tags/母板/" style="font-size: 10px;">母板</a> <a href="/tags/汇编/" style="font-size: 10px;">汇编</a> <a href="/tags/浮点数/" style="font-size: 10px;">浮点数</a> <a href="/tags/消息摘要/" style="font-size: 10px;">消息摘要</a> <a href="/tags/特权级/" style="font-size: 10px;">特权级</a> <a href="/tags/环境变量/" style="font-size: 10px;">环境变量</a> <a href="/tags/生成器/" style="font-size: 14.17px;">生成器</a> <a href="/tags/用户栈/" style="font-size: 10px;">用户栈</a> <a href="/tags/相似度/" style="font-size: 10.83px;">相似度</a> <a href="/tags/硬盘/" style="font-size: 12.5px;">硬盘</a> <a href="/tags/硬链接/" style="font-size: 10px;">硬链接</a> <a href="/tags/管道/" style="font-size: 10px;">管道</a> <a href="/tags/系统调用/" style="font-size: 10px;">系统调用</a> <a href="/tags/索引/" style="font-size: 10px;">索引</a> <a href="/tags/缓冲区/" style="font-size: 10.83px;">缓冲区</a> <a href="/tags/缓冲区溢出/" style="font-size: 10px;">缓冲区溢出</a> <a href="/tags/缺页中断/" style="font-size: 10px;">缺页中断</a> <a href="/tags/网络/" style="font-size: 13.33px;">网络</a> <a href="/tags/翻译/" style="font-size: 14.17px;">翻译</a> <a href="/tags/虚拟地址空间/" style="font-size: 10px;">虚拟地址空间</a> <a href="/tags/虚拟盘/" style="font-size: 10px;">虚拟盘</a> <a href="/tags/请求项/" style="font-size: 10px;">请求项</a> <a href="/tags/质数/" style="font-size: 10px;">质数</a> <a href="/tags/超级块/" style="font-size: 10px;">超级块</a> <a href="/tags/软盘/" style="font-size: 10px;">软盘</a> <a href="/tags/软链接/" style="font-size: 10px;">软链接</a> <a href="/tags/进程派生/" style="font-size: 10px;">进程派生</a> <a href="/tags/进程通信/" style="font-size: 10.83px;">进程通信</a> <a href="/tags/迭代器/" style="font-size: 10px;">迭代器</a> <a href="/tags/金融/" style="font-size: 10px;">金融</a> <a href="/tags/锁/" style="font-size: 10.83px;">锁</a> <a href="/tags/阻塞/" style="font-size: 10.83px;">阻塞</a> <a href="/tags/非阻塞/" style="font-size: 10.83px;">非阻塞</a> <a href="/tags/黑客/" style="font-size: 10px;">黑客</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">谢宏峰，毕业于暨南大学（2009 - 2013）、中国科学院（2013 - 2016），现就职于深信服科技，从事 OpenStack 开发。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Max</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/author.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Max</h1>
			</hgroup>
			
			<p class="header-subtitle">Stay hungry, stay foolish.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/categories/读书">读书</a></li>
		        
					<li><a href="/tags/翻译">翻译</a></li>
		        
					<li><a href="/categories/网络">网络</a></li>
		        
					<li><a href="/categories/并发">并发</a></li>
		        
					<li><a href="/categories/安全">安全</a></li>
		        
					<li><a href="/categories/运维">运维</a></li>
		        
					<li><a href="/categories/数据库">数据库</a></li>
		        
					<li><a href="/categories/云计算">云计算</a></li>
		        
					<li><a href="/categories/编程语言">编程语言</a></li>
		        
					<li><a href="/categories/操作系统">操作系统</a></li>
		        
					<li><a href="/categories/机器学习">机器学习</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xiehongfeng100" title="github">github</a>
			        
						<a class="linkedin" target="_blank" href="http://cn.linkedin.com/in/xiehongfeng100" title="linkedin">linkedin</a>
			        
						<a class="mail" target="_blank" href="mailto:xiehongfeng100@hotmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-python-web-routes" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/20/python-web-routes/" class="article-date">
  	<time datetime="2017-05-20T11:16:08.000Z" itemprop="datePublished">2017-05-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Routes
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WSGI/">WSGI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/routes/">routes</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/编程语言/">编程语言</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>按照<a href="http://routes.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">官方介绍</a>，Routes 是 Rails routes 的 Python 版，用于将不同的 URL 映射到对应的应用上，这对于开发 Restful URL 非常便利：</p>
<blockquote>
<p>Routes is a Python re-implementation of the Rails routes system for mapping URLs to application actions, and conversely to generate URLs. Routes makes it easy to create pretty and concise URLs that are RESTful with little effort.</p>
</blockquote>
<p><strong>注</strong>：关于 REST API，可参考以下优秀博文：</p>
<ul>
<li>REST API 作者的博文论文：<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm" target="_blank" rel="noopener">Architectural Styles and the Design of Network-based Software Architectures</a> （<a href="http://www.infoq.com/cn/minibooks/web-based-apps-archit-design#idp_register" target="_blank" rel="noopener">中文版</a>）</li>
<li><a href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api" target="_blank" rel="noopener">Best Practices for Designing a Pragmatic RESTful API</a> （<a href="http://weizhifeng.net/best-practices-for-a-pragmatic-restful-api.html#method-override" target="_blank" rel="noopener">中文版</a>）</li>
</ul>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a><strong>基本使用</strong></h1><p>对于 Routes，我们平常使用得比较多的就是其 Mapper 工具了。可以看看官方提供的<a href="http://routes.readthedocs.io/en/latest/index.html#example" target="_blank" rel="noopener">样例</a>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Setup a mapper</span></span><br><span class="line"><span class="keyword">from</span> routes <span class="keyword">import</span> Mapper</span><br><span class="line">map = Mapper()</span><br><span class="line">map.connect(<span class="literal">None</span>, <span class="string">"/error/&#123;action&#125;/&#123;id&#125;"</span>, controller=<span class="string">"error"</span>)</span><br><span class="line">map.connect(<span class="string">"home"</span>, <span class="string">"/"</span>, controller=<span class="string">"main"</span>, action=<span class="string">"index"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Match a URL, returns a dict or None if no match</span></span><br><span class="line">result = map.match(<span class="string">'/error/myapp/4'</span>)</span><br><span class="line"><span class="comment"># result == &#123;'controller': 'error', 'action': 'myapp', 'id': '4'&#125;</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h1 id="Routes-in-OpenStack"><a href="#Routes-in-OpenStack" class="headerlink" title="Routes in OpenStack"></a><strong>Routes in OpenStack</strong></h1><p>这里我们仿照 OpenStack Keystone 写了下边一个样例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> webob.dec</span><br><span class="line"><span class="keyword">import</span> webob.exc</span><br><span class="line"><span class="keyword">import</span> routes.middleware</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Environment variable used to pass the request context</span></span><br><span class="line">CONTEXT_ENV = <span class="string">'openstack.context'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Environment variable used to pass the request params</span></span><br><span class="line">PARAMS_ENV = <span class="string">'openstack.params'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseController</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_normalize_arg</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> arg.replace(<span class="string">':'</span>, <span class="string">'_'</span>).replace(<span class="string">'-'</span>, <span class="string">'_'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_normalize_dict</span><span class="params">(self, d)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;self._normalize_arg(k): v <span class="keyword">for</span> (k, v) <span class="keyword">in</span> d.items()&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_render_response</span><span class="params">(self, body=None, status=None, method=None)</span>:</span></span><br><span class="line">        <span class="string">'''Form a WSGI response.'''</span></span><br><span class="line">        resp = webob.Response(body=body, status=status)</span><br><span class="line">        resp.method = method</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        arg_dict = req.environ[<span class="string">'wsgiorg.routing_args'</span>][<span class="number">1</span>]</span><br><span class="line">        action = arg_dict.pop(<span class="string">'action'</span>)</span><br><span class="line">        <span class="keyword">del</span> arg_dict[<span class="string">'controller'</span>]</span><br><span class="line"></span><br><span class="line">        params = req.environ.get(PARAMS_ENV, &#123;&#125;)</span><br><span class="line">        params.update(arg_dict)</span><br><span class="line"></span><br><span class="line">        method = getattr(self, action)</span><br><span class="line">        params = self._normalize_dict(params)</span><br><span class="line">        result = method(req, **params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._render_response(body=result.body, status=result.status, method=req.method)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span><span class="params">(BaseController)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_user</span><span class="params">(self, req, user_id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> webob.Response(<span class="string">'I am a user, my ID is %s.'</span> % user_id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TenantController</span><span class="params">(BaseController)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_tenant</span><span class="params">(self, req, tenant_id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> webob.Response(<span class="string">'I am a tenant, my ID is %s.'</span> % tenant_id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._mapper = routes.Mapper()</span><br><span class="line">        self._mapper.connect(<span class="string">'/users/&#123;user_id&#125;'</span>,</span><br><span class="line">                             controller=UserController(),</span><br><span class="line">                             action=<span class="string">'get_user'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'GET'</span>]&#125;)</span><br><span class="line">        self._mapper.connect(<span class="string">'/tenants/&#123;tenant_id&#125;'</span>,</span><br><span class="line">                             controller=TenantController(),</span><br><span class="line">                             action=<span class="string">'get_tenant'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'GET'</span>]&#125;)</span><br><span class="line"></span><br><span class="line">        self._router = routes.middleware.RoutesMiddleware(self._dispatch, self._mapper)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._router</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dispatch</span><span class="params">(req)</span>:</span></span><br><span class="line">        match = req.environ[<span class="string">'wsgiorg.routing_args'</span>][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> match:</span><br><span class="line">            <span class="keyword">return</span> webob.exc.HTTPNotFound()</span><br><span class="line"></span><br><span class="line">        app = match[<span class="string">'controller'</span>]</span><br><span class="line">        <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router = Router()</span><br><span class="line">httpd = make_server(<span class="string">'localhost'</span>, <span class="number">8080</span>, router)</span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure></p>
<p>这里有几点需要注意的：</p>
<ol>
<li>因为服务端跟应用之间交互的标准是 WSGI，所以 Router 本身必须是一个 WSGI 应用（__call__(self.req)）。</li>
<li><code>Controller 路由</code> —— Router 对象初始化时会调用 routes 中间件（<code>RoutesMiddleware</code>），然后调用 <code>self._dispatch</code> 应用，将路由转发给相应的应用（UserController 和 TenantController）。<code>Router 实际做的只是路由到具体到 Controller 而已，而具体要路由到的最终方法（action）是不知道的</code>，且看下句：</li>
<li><code>具体方法路由</code> —— UserController 或 TenantController 被调用时（__call__(self.req)），对传入参数进行处理，并决定要调用的方法（method = getattr(self, action)），最后调用该方法并将结果标准化后返回。</li>
</ol>
<p>对于 routes 中间件 <code>RoutesMiddleware</code> 和 <code>self._dispatch</code>，这里详细说一下：</p>
<ol>
<li>self._dispatch 本身是一个 WSGI 应用，它和 self._mapper 一起作为参数初始化 routes.middleware.RoutesMiddleware 这个类。</li>
<li><p>RoutesMiddleware 也是一个 WSGI 应用（注意跟 self._dispatch 不是一个应用），当调用该应用时（__call__），会进行路由的匹配（注意这个参数 <code>wsgiorg.routing_args</code>）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># routes/middleware.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoutesMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, environ, start_response)</span>:</span></span><br><span class="line">        <span class="string">"""Resolves the URL in PATH_INFO, and uses wsgi.routing_args</span></span><br><span class="line"><span class="string">        to pass on URL resolver results."""</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Run the actual route matching</span></span><br><span class="line">        <span class="comment"># -- Assignment of environ to config triggers route matching</span></span><br><span class="line">        <span class="keyword">if</span> self.singleton:</span><br><span class="line">            config = request_config()</span><br><span class="line">            config.mapper = self.mapper</span><br><span class="line">            config.environ = environ</span><br><span class="line">            match = config.mapper_dict</span><br><span class="line">            route = config.route</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            results = self.mapper.routematch(environ=environ)</span><br><span class="line">            <span class="keyword">if</span> results:</span><br><span class="line">                match, route = results[<span class="number">0</span>], results[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                match = route = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        url = URLGenerator(self.mapper, environ)</span><br><span class="line">        environ[<span class="string">'wsgiorg.routing_args'</span>] = ((url), match)</span><br><span class="line">        environ[<span class="string">'routes.route'</span>] = route</span><br><span class="line">        environ[<span class="string">'routes.url'</span>] = url</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        response = self.app(environ, start_response)  <span class="comment"># 调用 self._dispatch 这个 WSGI 应用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Wrapped in try as in rare cases the attribute will be gone already</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">del</span> self.mapper.environ</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
</li>
<li><p>RoutesMiddleware 最后会调用 self._dispatch 这个 WSGI 应用，然后再由其调用对象的 Controller（WSGI 应用）。</p>
</li>
</ol>
<h1 id="Routes-Resource"><a href="#Routes-Resource" class="headerlink" title="Routes Resource"></a><strong>Routes Resource</strong></h1><p>在实际中，对某个资源一般会有一些常见操作，如 CRUD，于是乎，用上一小节的方法，我们可能就要自己添加多个路由映射：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._mapper = routes.Mapper()</span><br><span class="line">        self._mapper.connect(<span class="string">'/users'</span>,</span><br><span class="line">                             controller=UserController(),</span><br><span class="line">                             action=<span class="string">'create_user'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'POST'</span>]&#125;)</span><br><span class="line">        self._mapper.connect(<span class="string">'/users/&#123;user_id&#125;'</span>,</span><br><span class="line">                             controller=UserController(),</span><br><span class="line">                             action=<span class="string">'get_user'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'GET'</span>]&#125;)</span><br><span class="line">        self._mapper.connect(<span class="string">'/users/&#123;user_id&#125;'</span>,</span><br><span class="line">                             controller=UserController(),</span><br><span class="line">                             action=<span class="string">'update_user'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'PUT'</span>]&#125;)</span><br><span class="line">        self._mapper.connect(<span class="string">'/users/&#123;user_id&#125;'</span>,</span><br><span class="line">                             controller=UserController(),</span><br><span class="line">                             action=<span class="string">'delete_user'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'DELETE'</span>]&#125;)</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        self._router = routes.middleware.RoutesMiddleware(self._dispatch, self._mapper)</span><br></pre></td></tr></table></figure></p>
<p>但我们要操作的资源较少时，这种做法问题不大，但当资源种类特别多的时候，这种方法就有点笨拙了，尤其是像 OpenStack Nova 模块涉及的资源太多，要是单纯为每个资源都添加个 CRUD，这个路由映射表就够大的了；另外，这种做法也不符合复用的思想。所以，我们期望，<code>对资源的一些常见操作，我们希望 routes 包能够帮我们封装好；对一些非常见操作提供支持。</code>要做到这个，就要用到 <code>routes.resource</code> 这个工具了。</p>
<p>关于 routes.resource 详细介绍，可参考其<a href="http://routes.readthedocs.io/en/latest/restful.html" target="_blank" rel="noopener">官方文档</a>。接下来我们就直接上样例吧：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseController</span><span class="params">(object)</span>:</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span><span class="params">(BaseController)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.index'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.create'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self, req, id)</span>:</span>    <span class="comment"># The same with get_user(self, req, id)</span></span><br><span class="line">        msg = <span class="string">'in UserController.show'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, req, id)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.update'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, req, id)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.delete'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ask_delete</span><span class="params">(self, req, id)</span>:</span>  <span class="comment"># Special action</span></span><br><span class="line">        msg = <span class="string">'in UserController.ask_delete'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._mapper = routes.Mapper()</span><br><span class="line">        self._mapper.resource(<span class="string">'user'</span>, <span class="string">'users'</span>,</span><br><span class="line">                              controller=UserController(),</span><br><span class="line">                              member=&#123;<span class="string">'ask_delete'</span>: <span class="string">'DELETE'</span>&#125;)  <span class="comment"># ask_delete 是非常见操作</span></span><br><span class="line"></span><br><span class="line">        self._router = routes.middleware.RoutesMiddleware(self._dispatch, self._mapper)</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>我们可以利用发包工具（如 <a href="https://www.getpostman.com/" target="_blank" rel="noopener">POSTMAN</a>）向服务器发送请求，下边是服务器截获到的请求：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">21</span>/May/<span class="number">2017</span> <span class="number">15</span>:<span class="number">39</span>:<span class="number">37</span>] <span class="string">"GET /users HTTP/1.1"</span> <span class="number">200</span> <span class="number">23</span></span><br><span class="line"><span class="keyword">in</span> UserController.index</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">21</span>/May/<span class="number">2017</span> <span class="number">15</span>:<span class="number">39</span>:<span class="number">47</span>] <span class="string">"POST /users HTTP/1.1"</span> <span class="number">200</span> <span class="number">24</span></span><br><span class="line"><span class="keyword">in</span> UserController.create</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">21</span>/May/<span class="number">2017</span> <span class="number">15</span>:<span class="number">39</span>:<span class="number">56</span>] <span class="string">"GET /users/520 HTTP/1.1"</span> <span class="number">200</span> <span class="number">22</span></span><br><span class="line"><span class="keyword">in</span> UserController.show</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">21</span>/May/<span class="number">2017</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">02</span>] <span class="string">"PUT /users/520 HTTP/1.1"</span> <span class="number">200</span> <span class="number">24</span></span><br><span class="line"><span class="keyword">in</span> UserController.update</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">21</span>/May/<span class="number">2017</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">09</span>] <span class="string">"DELETE /users/520 HTTP/1.1"</span> <span class="number">200</span> <span class="number">24</span></span><br><span class="line"><span class="keyword">in</span> UserController.delete</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">21</span>/May/<span class="number">2017</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">12</span>] <span class="string">"DELETE /users/520/ask_delete HTTP/1.1"</span> <span class="number">200</span> <span class="number">28</span></span><br><span class="line"><span class="keyword">in</span> UserController.ask_delete</span><br></pre></td></tr></table></figure></p>
<p>不同的路由就会进入不同的处理函数。</p>
<h1 id="Routes-and-PasteDeploy"><a href="#Routes-and-PasteDeploy" class="headerlink" title="Routes and PasteDeploy"></a><strong>Routes and PasteDeploy</strong></h1><p>只有将 Routes 和 PasteDeploy 相结合起来，才能算完满！那就开始吧！</p>
<p>这两者一旦放在一起就容易混淆，不过只要清楚它们的作用，区分开来还是比较简单的。简单点讲，<code>PasteDeploy “主外”，Routes “主内”，也即，PasteDeploy 关注的是中间件加应用的流水线，流水线终点是 Router，是大的方面；Routes 关注的是最终 URL 的分发，关注的是分发到具体应用（Controller），是小的方面。</code>下边我们来直接看样例吧：</p>
<p>配置文件：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># resource.ini</span></span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">key1 = value1</span><br><span class="line">key2 = value2</span><br><span class="line">key3 = values</span><br><span class="line"></span><br><span class="line">[filter:logrequest]</span><br><span class="line">username = root</span><br><span class="line">password = root123</span><br><span class="line">paste.filter_factory = resource:LogFilter.factory</span><br><span class="line"></span><br><span class="line">[app:router]</span><br><span class="line">paste.app_factory = resource:Router.factory  <span class="comment"># 注意这里是 Router 而不是 UserController 之类的 Controller</span></span><br><span class="line"></span><br><span class="line">[pipeline:router_pipeline]</span><br><span class="line">pipeline = logrequest router</span><br><span class="line"></span><br><span class="line">[composite:main]</span><br><span class="line">use = egg:Paste<span class="comment">#urlmap</span></span><br><span class="line">/ : router_pipeline     <span class="comment"># 注意，如果我们这里写为 /router : router_pipeline，那这里的 router 实际是</span></span><br><span class="line">                        <span class="comment"># 给 PasteDeploy 匹配用的，在传给 Router 时，这个 URL 中的 router 会被去掉，</span></span><br><span class="line">                        <span class="comment"># 也就是说，如果我们想访问 UserController，那我们的 URL 就要写为 </span></span><br><span class="line">                        <span class="comment"># GET http://ip:port/router/users/id。一般情况下，我们是不用这么做的，直接用“/”就可以了。</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># 另外，我们一般会有多个版本的 API，这里如写为 /v1 : router_pipeline 就很适合，</span></span><br><span class="line">                        <span class="comment"># 这样我们在最外层就已经做了 API 版本分流，而不用在 Router 里边分流。</span></span><br></pre></td></tr></table></figure></p>
<p>源码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># resource.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> webob.dec</span><br><span class="line"><span class="keyword">import</span> webob.exc</span><br><span class="line"><span class="keyword">import</span> routes.middleware</span><br><span class="line"><span class="keyword">from</span> paste.deploy <span class="keyword">import</span> loadapp</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Environment variable used to pass the request context</span></span><br><span class="line">CONTEXT_ENV = <span class="string">'openstack.context'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Environment variable used to pass the request params</span></span><br><span class="line">PARAMS_ENV = <span class="string">'openstack.params'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogFilter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, app)</span>:</span></span><br><span class="line">        self.app = app</span><br><span class="line"></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'filter:LogFilter is called.'</span></span><br><span class="line">        <span class="keyword">return</span> self.app</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">factory</span><span class="params">(cls, global_conf, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'in LogFilter.factory'</span>, global_conf, kwargs</span><br><span class="line">        <span class="keyword">return</span> cls	<span class="comment"># 注意 PasteDeploy 流水线中间件返回的不是类实例，因为它还要用于应用初始化（__init__(self, app)）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseController</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_normalize_arg</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> arg.replace(<span class="string">':'</span>, <span class="string">'_'</span>).replace(<span class="string">'-'</span>, <span class="string">'_'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_normalize_dict</span><span class="params">(self, d)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;self._normalize_arg(k): v <span class="keyword">for</span> (k, v) <span class="keyword">in</span> d.items()&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_render_response</span><span class="params">(self, body=None, status=None, method=None)</span>:</span></span><br><span class="line">        <span class="string">'''Form a WSGI response.'''</span></span><br><span class="line">        resp = webob.Response(body=body, status=status)</span><br><span class="line">        resp.method = method</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        arg_dict = req.environ[<span class="string">'wsgiorg.routing_args'</span>][<span class="number">1</span>]</span><br><span class="line">        action = arg_dict.pop(<span class="string">'action'</span>)</span><br><span class="line">        <span class="keyword">del</span> arg_dict[<span class="string">'controller'</span>]</span><br><span class="line"></span><br><span class="line">        params = req.environ.get(PARAMS_ENV, &#123;&#125;)</span><br><span class="line">        params.update(arg_dict)</span><br><span class="line"></span><br><span class="line">        method = getattr(self, action)</span><br><span class="line">        params = self._normalize_dict(params)</span><br><span class="line">        result = method(req, **params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._render_response(body=result.body, status=result.status, method=req.method)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span><span class="params">(BaseController)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.index'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.create'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self, req, id)</span>:</span>    <span class="comment"># The same with get_user(self, req, id)</span></span><br><span class="line">        msg = <span class="string">'in UserController.show'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, req, id)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.update'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, req, id)</span>:</span></span><br><span class="line">        msg = <span class="string">'in UserController.delete'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ask_delete</span><span class="params">(self, req, id)</span>:</span>  <span class="comment"># Special action</span></span><br><span class="line">        msg = <span class="string">'in UserController.ask_delete'</span></span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line">        <span class="keyword">return</span> webob.Response(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TenantController</span><span class="params">(BaseController)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_tenant</span><span class="params">(self, req, tenant_id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> webob.Response(<span class="string">'I am a tenant, my ID is %s.'</span> % tenant_id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._mapper = routes.Mapper()</span><br><span class="line">        self._mapper.resource(<span class="string">'user'</span>, <span class="string">'users'</span>,</span><br><span class="line">                              controller=UserController(),</span><br><span class="line">                              member=&#123;<span class="string">'ask_delete'</span>: <span class="string">'DELETE'</span>&#125;)</span><br><span class="line">        self._mapper.connect(<span class="string">'/tenants/&#123;tenant_id&#125;'</span>,</span><br><span class="line">                             controller=TenantController(),</span><br><span class="line">                             action=<span class="string">'get_tenant'</span>,</span><br><span class="line">                             conditions=&#123;<span class="string">'method'</span>: [<span class="string">'GET'</span>]&#125;)</span><br><span class="line"></span><br><span class="line">        self._router = routes.middleware.RoutesMiddleware(self._dispatch, self._mapper)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, req)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._router</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line"><span class="meta">    @webob.dec.wsgify</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_dispatch</span><span class="params">(req)</span>:</span></span><br><span class="line">        match = req.environ[<span class="string">'wsgiorg.routing_args'</span>][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> match:</span><br><span class="line">            <span class="keyword">return</span> webob.exc.HTTPNotFound()</span><br><span class="line"></span><br><span class="line">        app = match[<span class="string">'controller'</span>]</span><br><span class="line">        <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">factory</span><span class="params">(cls, global_conf, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'in Router.factory'</span>, global_conf, kwargs</span><br><span class="line">        <span class="keyword">return</span> cls()	<span class="comment"># PasteDeploy 流水线最终应用，直接返回类实例即可</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app_name = <span class="string">'main'</span></span><br><span class="line">    config_file = <span class="string">'resource.ini'</span></span><br><span class="line">    wsgi_app = loadapp(<span class="string">'config:%s'</span> % os.path.abspath(config_file), app_name)</span><br><span class="line">    server = make_server(<span class="string">'localhost'</span>, <span class="number">8080</span>, wsgi_app)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure></p>
<p>先这样吧，有需要再继续改进！</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/06/08/openstack-source-code-series-preface/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          OpenStack 源码系列前言
        
      </div>
    </a>
  
  
    <a href="/2017/05/20/python-web-paste-deploy/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">PasteDeploy</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>







      <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>

<script>
var gitalk = new Gitalk({
  clientID: '64c19d7f57bebbb343c4',
  clientSecret: '287daeba39e73fdde92f24540c9f3c0fd5238512',
  repo: 'BlogComments',
  owner: 'xiemax100',
  admin: ['xiemax100'],
  id: md5(window.location.pathname),
  distractionFreeMode: true
})

gitalk.render('gitalk-container')
</script>






    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基本使用"><span class="toc-number">1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Routes-in-OpenStack"><span class="toc-number">2.</span> <span class="toc-text">Routes in OpenStack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Routes-Resource"><span class="toc-number">3.</span> <span class="toc-text">Routes Resource</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Routes-and-PasteDeploy"><span class="toc-number">4.</span> <span class="toc-text">Routes and PasteDeploy</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var toc_button = document.getElementById("tocButton");
    var toc_div = document.getElementById("toc");
    toc_button.onclick=function() {
        if (toc_div.style.display == "none") {
            toc_div.style.display = "block";
            toc_button.value = "隐藏目录";
            document.getElementById("switch-btn").style.display = "none";
            document.getElementById("switch-area").style.display = "none";
        }
        else {
            toc_div.style.display = "none";
            toc_button.value = "显示目录";
            document.getElementById("switch-btn").style.display = "block";
            document.getElementById("switch-area").style.display = "block";
        }
    }

    if ($(".toc").length < 1) {
        $("#toc").css("display","none");
        $("#tocButton").css("display","none");
        $(".switch-btn").css("display","block");
        $(".switch-area").css("display","block");
    }
</script>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 Max
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>